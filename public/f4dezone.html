<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F4DEZONE - Proposta Sistema Pay-Per-Use</title>
    <meta name="description" content="Proposta Sistema Pay-Per-Use per F4DEZONE BARBERS - Domenico Riccio Web & App Solutions">
    <meta name="robots" content="noindex, nofollow">

    <!-- jsPDF per generazione PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }



        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-card h2 {
            color: #2c5aa0;
            margin-bottom: 30px;
            font-size: clamp(22px, 5vw, 28px);
        }

        .login-card p {
            color: #666;
            margin-bottom: 30px;
            font-size: clamp(14px, 3vw, 16px);
        }

        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: clamp(14px, 3vw, 16px);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(44, 90, 160, 0.3);
        }

        .error-message {
            color: #ff6b35;
            margin-top: 15px;
            font-size: clamp(12px, 2.5vw, 14px);
            display: none;
        }

        /* Timer Display */
        .timer-display {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 15px;
            text-align: center;
            margin: -20px -20px 30px -20px;
            font-weight: bold;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .timer-display.expired {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2c5aa0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #2c5aa0;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2c5aa0, #4CAF50);
        }

        .status-banner {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 15px;
            text-align: center;
            margin: -20px -20px 30px -20px;
            font-weight: bold;
            display: none;
        }

        .status-banner.signed {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: block;
        }

        .header {
            background: white;
            color: #333;
            border-bottom: 4px solid #2c5aa0;
            padding-bottom: 25px;
            margin-bottom: 40px;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .company-info h1 {
            color: #2c5aa0;
            font-size: clamp(24px, 5vw, 32px);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .company-info .tagline {
            font-size: clamp(14px, 3vw, 18px);
            color: #333;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .company-info p, .client-info p {
            font-size: clamp(12px, 2.5vw, 14px);
            margin-bottom: 3px;
            color: #333;
        }

        .client-info {
            text-align: right;
        }

        .client-info h2 {
            color: #2c5aa0;
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 8px;
        }

        .app-title {
            text-align: center;
            margin: 40px 0;
            padding: 40px 20px;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.3);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .app-title:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(44, 90, 160, 0.4);
        }

        .app-title h1 {
            font-size: clamp(28px, 6vw, 42px);
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .app-title p {
            font-size: clamp(16px, 4vw, 22px);
            opacity: 0.95;
        }

        .section {
            margin-bottom: 50px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section h2 {
            color: #2c5aa0;
            font-size: clamp(18px, 4vw, 26px);
            margin-bottom: 25px;
            border-bottom: 3px solid #e3f2fd;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .section h2::before {
            content: "▶";
            margin-right: 15px;
            color: #4CAF50;
            font-size: 0.8em;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .pricing-plan {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #2c5aa0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pricing-plan::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #2c5aa0, #4CAF50);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .pricing-plan:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .pricing-plan:hover::before {
            transform: scaleX(1);
        }

        .pricing-plan.featured {
            border-left: 5px solid #4CAF50;
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.2);
        }

        .pricing-plan.featured .plan-badge {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: absolute;
            top: -10px;
            right: 20px;
        }

        .plan-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .plan-name {
            color: #2c5aa0;
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .plan-price {
            color: #4CAF50;
            font-size: clamp(24px, 5vw, 32px);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .plan-range {
            color: #666;
            font-size: clamp(14px, 3vw, 16px);
            margin-bottom: 20px;
            padding: 8px 15px;
            background: #f0f7ff;
            border-radius: 20px;
            text-align: center;
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .plan-features li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
            color: #555;
            font-size: clamp(13px, 2.8vw, 15px);
            line-height: 1.5;
        }

        .plan-features li::before {
            content: "✓";
            color: #4CAF50;
            font-weight: bold;
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }

        .monitoring-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 35px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(44, 90, 160, 0.1);
        }

        .monitoring-section h3 {
            color: #2c5aa0;
            margin-bottom: 20px;
            font-size: clamp(16px, 3.5vw, 20px);
            text-align: center;
        }

        .usage-dashboard {
            background: #1a1a1a;
            color: #00ff00;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            border: 2px solid #333;
            overflow-x: auto;
        }

        .usage-bar {
            background: #333;
            height: 20px;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
        }

        .usage-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .alert-system {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid #ff6b35;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .alert-system h4 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: clamp(14px, 3vw, 18px);
        }

        .billing-section {
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .billing-section h3 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 30px;
            font-size: clamp(18px, 4vw, 24px);
        }

        .code-block {
            background: #1a1a1a;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: clamp(11px, 2.2vw, 13px);
            border: 1px solid #333;
        }

        .highlight {
            color: #66d9ef;
        }

        .string {
            color: #a6e22e;
        }

        .comment {
            color: #75715e;
            font-style: italic;
        }

        .roi-analysis {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }

        .roi-analysis h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: clamp(16px, 3.5vw, 20px);
        }

        .roi-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .roi-stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
        }

        .roi-stat .number {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            color: #2c5aa0;
        }

        .roi-stat .label {
            font-size: clamp(12px, 2.5vw, 14px);
            color: #666;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: linear-gradient(135deg, #2c5aa0, #1e4080);
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-size: clamp(14px, 3vw, 16px);
        }

        .comparison-table td {
            padding: 18px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .comparison-table .month {
            font-weight: 600;
            color: #333;
        }

        .comparison-table .growth {
            color: #4CAF50;
            font-weight: bold;
        }

        .signature-section {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 40px;
            border-radius: 20px;
            margin: 50px 0;
            border: 3px solid #2c5aa0;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.15);
        }

        .signature-section h2 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 30px;
            font-size: clamp(20px, 4.5vw, 28px);
        }

        .signature-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .acceptance-checkboxes {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #4CAF50;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: #4CAF50;
            margin-top: 2px;
        }

        .checkbox-item label {
            cursor: pointer;
            line-height: 1.5;
            color: #333;
        }

        .signature-canvas-container {
            background: white;
            border: 3px dashed #2c5aa0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .signature-canvas {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: crosshair;
            width: 100%;
            max-width: 500px;
            height: 200px;
            background: #fafafa;
        }

        .signature-controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(13px, 2.8vw, 15px);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-clear {
            background: #ff6b35;
            color: white;
        }

        .btn-clear:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        .btn-submit {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 40px;
            font-size: clamp(15px, 3vw, 18px);
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .signature-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: clamp(12px, 2.5vw, 14px);
            color: #666;
            text-align: center;
        }

        .success-message {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            display: none;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);
        }

        .success-message.show {
            display: block;
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .signature-preview {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #4CAF50;
            margin-top: 20px;
            display: none;
        }

        .signature-preview h4 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: clamp(14px, 3vw, 16px);
        }

        .signature-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            font-size: clamp(12px, 2.5vw, 14px);
        }

        .cta-section {
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            padding: 50px 30px;
            border-radius: 20px;
            text-align: center;
            margin: 50px 0;
            box-shadow: 0 20px 50px rgba(44, 90, 160, 0.3);
        }

        .cta-section h2 {
            font-size: clamp(20px, 5vw, 32px);
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cta-section p {
            font-size: clamp(14px, 3vw, 18px);
            margin-bottom: 15px;
            opacity: 0.95;
        }

        .contact-section {
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .contact-section h3 {
            color: #2c5aa0;
            margin-bottom: 25px;
            font-size: clamp(18px, 4vw, 24px);
        }

        .contact-section p {
            font-size: clamp(14px, 3vw, 18px);
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
                border-radius: 10px;
            }

            .header {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }

            .client-info {
                text-align: center;
            }

            .pricing-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .pricing-plan.featured {
                transform: none;
            }

            .signature-controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }

            .code-block {
                font-size: 10px;
                padding: 15px;
            }

            .usage-dashboard {
                padding: 15px;
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .app-title {
                padding: 25px 15px;
            }

            .section {
                margin-bottom: 30px;
            }

            .pricing-plan,
            .monitoring-section,
            .billing-section,
            .signature-section {
                padding: 20px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h2>🔐 Accesso Riservato</h2>
            <p>Proposta F4DEZONE Sistema Pay-Per-Use<br>Inserisci la password per accedere</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="Password" />
            <button class="login-btn" onclick="checkPassword()">🚀 Accedi alla Proposta</button>
            <div class="error-message" id="errorMessage">⚠️ Password errata. Riprova.</div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Invio proposta firmata in corso...</div>
    </div>

    <div class="container" id="proposalContainer" style="display: none;">
        <div class="timer-display" id="timerDisplay">
            ⏰ Tempo rimanente per firmare: <span id="timerText"></span>
        </div>

        <div class="status-banner" id="statusBanner">
            ✅ PROPOSTA FIRMATA E ACCETTATA DIGITALMENTE
        </div>

        <div class="header">
            <div class="company-info">
                <h1>Domenico Riccio</h1>
                <div class="tagline">Full-Stack Developer - Web & App Solutions</div>
                <p><strong>Sviluppatore Full-Stack Senior</strong></p>
                <p>Via Ol Mött 6, 6703 Osogna, Svizzera</p>
                <p>📞 Tel: 076 781 01 94</p>
                <p>✉️ Email: info@dcreativo.ch</p>
                <p>🌐 Web: dcreativo.ch</p>
            </div>
            <div class="client-info">
                <h2>F4DEZONE BARBERS</h2>
                <p><strong>Santiago Prat - Proprietario</strong></p>
                <p>Via Zurigo 2, 6900 Lugano</p>
                <p>📞 Tel: +41 78 930 15 99</p>
                <p>✉️ Email: info@dcreativo.ch</p> <!-- EMAIL TEST -->
                <p style="margin-top: 15px; color: #666;"><strong>Data:</strong> <span id="currentDate"></span></p>
            </div>
        </div>

        <div class="app-title">
            <h1>🚀 Sistema Pay-Per-Use F4DEZONE</h1>
            <p>Abbonamento Dinamico Basato sull'Utilizzo Reale - Cresci e Paga Solo Quello che Usi</p>
        </div>

        <div class="section">
            <h2>💡 Concetto Innovativo</h2>
            <div class="roi-analysis">
                <h3>🎯 Sistema di Billing Intelligente</h3>
                <div class="roi-stats">
                    <div class="roi-stat">
                        <div class="number">📊</div>
                        <div class="label">Monitoraggio Automatico</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">💰</div>
                        <div class="label">Costi Proporzionali</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">🔄</div>
                        <div class="label">Scalabilità Automatica</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">📈</div>
                        <div class="label">Crescita Supportata</div>
                    </div>
                </div>
                <p><strong>Cresci e paga solo quello che usi realmente!</strong></p>
            </div>
        </div>

        <div class="section">
            <h2>📋 Piani di Utilizzo Dinamici</h2>
            <div class="pricing-grid">
                <div class="pricing-plan">
                    <span class="plan-icon">🌱</span>
                    <div class="plan-name">STARTER</div>
                    <div class="plan-price">CHF 89/mese</div>
                    <div class="plan-range">0-100 prenotazioni/mese</div>
                    <ul class="plan-features">
                        <li>Fino a 100 prenotazioni</li>
                        <li>500 email automatiche</li>
                        <li>100 SMS promemoria</li>
                        <li>2 barbieri attivi</li>
                        <li>Supporto email</li>
                        <li>Backup settimanali</li>
                    </ul>
                </div>

                <div class="pricing-plan featured">
                    <div class="plan-badge">CONSIGLIATO</div>
                    <span class="plan-icon">🚀</span>
                    <div class="plan-name">BUSINESS</div>
                    <div class="plan-price">CHF 149/mese</div>
                    <div class="plan-range">101-300 prenotazioni/mese</div>
                    <ul class="plan-features">
                        <li>Fino a 300 prenotazioni</li>
                        <li>1,500 email automatiche</li>
                        <li>300 SMS promemoria</li>
                        <li>5 barbieri attivi</li>
                        <li>WhatsApp Business API</li>
                        <li>Supporto prioritario</li>
                        <li>Backup giornalieri</li>
                        <li>Analytics avanzati</li>
                    </ul>
                </div>

                <div class="pricing-plan">
                    <span class="plan-icon">💎</span>
                    <div class="plan-name">PREMIUM</div>
                    <div class="plan-price">CHF 249/mese</div>
                    <div class="plan-range">301-1000 prenotazioni/mese</div>
                    <ul class="plan-features">
                        <li>Fino a 1,000 prenotazioni</li>
                        <li>Email illimitate</li>
                        <li>1,000 SMS promemoria</li>
                        <li>Barbieri illimitati</li>
                        <li>Assistenza telefonica</li>
                        <li>Backup in tempo reale</li>
                        <li>Report personalizzati</li>
                        <li>Integrazioni personalizzate</li>
                    </ul>
                </div>

                <div class="pricing-plan">
                    <span class="plan-icon">🏆</span>
                    <div class="plan-name">ENTERPRISE</div>
                    <div class="plan-price">CHF 0.25</div>
                    <div class="plan-range">per prenotazione oltre le 1000</div>
                    <ul class="plan-features">
                        <li>Prenotazioni illimitate</li>
                        <li>Tutti i servizi inclusi</li>
                        <li>Dedicato account manager</li>
                        <li>SLA 99.9% garantito</li>
                        <li>Sviluppi personalizzati</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🔄 Sistema di Monitoraggio Automatico</h2>
            <div class="monitoring-section">
                <h3>📊 Metriche Tracciate in Real-Time</h3>

                <div class="code-block">
<span class="comment">// Esempio di tracking automatico</span>
<span class="highlight">const</span> usageMetrics = {
  <span class="string">appointments</span>: {
    current: <span class="highlight">234</span>,
    limit: <span class="highlight">300</span>,
    percentage: <span class="highlight">78</span>%
  },
  <span class="string">emails</span>: {
    current: <span class="highlight">1127</span>,
    limit: <span class="highlight">1500</span>,
    percentage: <span class="highlight">75</span>%
  },
  <span class="string">sms</span>: {
    current: <span class="highlight">189</span>,
    limit: <span class="highlight">300</span>,
    percentage: <span class="highlight">63</span>%
  }
}
                </div>

                <div class="usage-dashboard">
┌─────────────────────────────────────┐
│         UTILIZZO CORRENTE           │
├─────────────────────────────────────┤
│ 📅 Prenotazioni: 234/300 (78%)     │
│ <div class="usage-bar"><div class="usage-fill" style="width: 78%"></div></div> │
│                                     │
│ 📧 Email inviate: 1,127/1,500      │
│ <div class="usage-bar"><div class="usage-fill" style="width: 75%"></div></div> │
│                                     │
│ 📱 SMS inviati: 189/300 (63%)      │
│ <div class="usage-bar"><div class="usage-fill" style="width: 63%"></div></div> │
│                                     │
│ 💰 Costo corrente: CHF 149/mese    │
│ 📊 Piano attuale: BUSINESS         │
└─────────────────────────────────────┘
                </div>

                <div class="alert-system">
                    <h4>🔔 Sistema di Notifiche Automatiche</h4>
                    <p><strong>75% raggiunto:</strong> "Stai utilizzando il 75% del tuo piano"</p>
                    <p><strong>90% raggiunto:</strong> "Considera l'upgrade al piano superiore"</p>
                    <p><strong>95% raggiunto:</strong> "Upgrade consigliato per evitare limitazioni"</p>
                    <p><strong>100% raggiunto:</strong> "Upgrade automatico attivato" (se autorizzato)</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>💳 Implementazione Tecnica Stripe</h2>
            <div class="billing-section">
                <h3>🔧 Billing Automatico con Stripe</h3>

                <div class="code-block">
<span class="comment">// Sistema di billing dinamico</span>
<span class="highlight">const</span> calculateMonthlyBill = (usage) => {
  <span class="highlight">const</span> { appointments, emails, sms } = usage;

  <span class="comment">// Determina il piano base</span>
  <span class="highlight">let</span> basePlan = <span class="string">'starter'</span>;
  <span class="highlight">let</span> basePrice = <span class="highlight">89</span>;

  <span class="highlight">if</span> (appointments > <span class="highlight">300</span>) {
    basePlan = <span class="string">'premium'</span>;
    basePrice = <span class="highlight">249</span>;
  } <span class="highlight">else if</span> (appointments > <span class="highlight">100</span>) {
    basePlan = <span class="string">'business'</span>;
    basePrice = <span class="highlight">149</span>;
  }

  <span class="comment">// Calcola extra costs per enterprise</span>
  <span class="highlight">let</span> extraCosts = <span class="highlight">0</span>;
  <span class="highlight">if</span> (appointments > <span class="highlight">1000</span>) {
    extraCosts = (appointments - <span class="highlight">1000</span>) * <span class="highlight">0.25</span>;
  }

  <span class="highlight">return</span> {
    basePlan,
    basePrice,
    extraCosts,
    totalPrice: basePrice + extraCosts,
    nextBillingDate: getNextBillingDate(),
    upgradeRecommended: shouldRecommendUpgrade(usage)
  };
};
                </div>
            </div>
        </div>

        <div class="section">
            <h2>💰 Calcolo Costi Dinamici</h2>
            <div class="billing-section">
                <h3>📊 Esempio Pratico Crescita Business</h3>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Mese</th>
                            <th>Prenotazioni</th>
                            <th>Piano</th>
                            <th>Costo</th>
                            <th>Crescita</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="month">Gen</td>
                            <td>67 prenotazioni</td>
                            <td>Starter</td>
                            <td>CHF 89</td>
                            <td class="growth">+15%</td>
                        </tr>
                        <tr>
                            <td class="month">Feb</td>
                            <td>89 prenotazioni</td>
                            <td>Starter</td>
                            <td>CHF 89</td>
                            <td class="growth">+33%</td>
                        </tr>
                        <tr>
                            <td class="month">Mar</td>
                            <td>125 prenotazioni</td>
                            <td>Business</td>
                            <td>CHF 149</td>
                            <td class="growth">+40%</td>
                        </tr>
                        <tr>
                            <td class="month">Apr</td>
                            <td>178 prenotazioni</td>
                            <td>Business</td>
                            <td>CHF 149</td>
                            <td class="growth">+42%</td>
                        </tr>
                        <tr>
                            <td class="month">Mag</td>
                            <td>267 prenotazioni</td>
                            <td>Business</td>
                            <td>CHF 149</td>
                            <td class="growth">+50%</td>
                        </tr>
                        <tr>
                            <td class="month">Giu</td>
                            <td>334 prenotazioni</td>
                            <td>Premium</td>
                            <td>CHF 249</td>
                            <td class="growth">+25%</td>
                        </tr>
                    </tbody>
                </table>

                <div class="roi-analysis">
                    <h3>💡 ROI Analysis per F4DEZONE</h3>
                    <div class="roi-stats">
                        <div class="roi-stat">
                            <div class="number">CHF 35</div>
                            <div class="label">Prenotazione Media</div>
                        </div>
                        <div class="roi-stat">
                            <div class="number">CHF 10,500</div>
                            <div class="label">Fatturato (300 prenotazioni)</div>
                        </div>
                        <div class="roi-stat">
                            <div class="number">1.4%</div>
                            <div class="label">Costo App sul Fatturato</div>
                        </div>
                        <div class="roi-stat">
                            <div class="number">98.6%</div>
                            <div class="label">Profitto Netto</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🎯 Vantaggi Soluzione Pay-Per-Use</h2>
            <div class="pricing-grid" style="grid-template-columns: 1fr 1fr;">
                <div class="pricing-plan">
                    <span class="plan-icon">👤</span>
                    <div class="plan-name">Per F4DEZONE</div>
                    <ul class="plan-features">
                        <li>Start a CHF 89/mese invece di CHF 295</li>
                        <li>Crescita graduale dei costi con il business</li>
                        <li>Nessun rischio di sovra-pagamento</li>
                        <li>Trasparenza totale sui costi</li>
                        <li>Scala automaticamente con il successo</li>
                    </ul>
                </div>

                <div class="pricing-plan">
                    <span class="plan-icon">💻</span>
                    <div class="plan-name">Per lo Sviluppatore</div>
                    <ul class="plan-features">
                        <li>Revenue crescente con il cliente</li>
                        <li>Incentivo alla qualità (più usi = più guadagno)</li>
                        <li>Partnership a lungo termine</li>
                        <li>Dati di utilizzo per ottimizzazioni</li>
                        <li>Modello sostenibile e scalabile</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>📋 Proposta Finale</h2>
            <div class="roi-analysis">
                <h3>🎯 Raccomandazione per F4DEZONE</h3>
                <p><strong>✅ STARTER Plan: CHF 89/mese</strong> (Perfetto per iniziare)</p>
                <p><strong>🎯 OBIETTIVO:</strong> Crescita fino a Business Plan</p>
                <p>📈 +23% prenotazioni ogni 3 mesi</p>
                <p>💰 CHF 149/mese quando raggiungi 150+ prenotazioni</p>
                <p><strong>🏆 RISULTATO:</strong> App che si paga da sola</p>
                <p>💡 1.4% del fatturato per gestione completa</p>
            </div>

            <div class="billing-section">
                <h3>🤝 Partnership Personalizzata Completa</h3>
                <p style="text-align: center; margin-bottom: 25px; font-size: clamp(14px, 3vw, 16px); color: #666;">
                    <strong>Nota:</strong> I 5 tagli già effettuati sono stati il pagamento per il lavoro precedente svolto
                </p>
                <div class="roi-stats">
                    <div class="roi-stat">
                        <div class="number">✂️</div>
                        <div class="label"><strong>1 taglio completo/mese</strong><br>In cambio di design e poster</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">📧</div>
                        <div class="label"><strong>Setup Gmail Business</strong><br>Account professionale</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">🗺️</div>
                        <div class="label"><strong>Google Business Profile</strong><br>Ottimizzazione completa</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">🎯</div>
                        <div class="label"><strong>Google Ads Setup</strong><br>Campagne ottimizzate</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">📸</div>
                        <div class="label"><strong>Foto Professionali</strong><br>Barbers + ambiente</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">🎬</div>
                        <div class="label"><strong>Video Barbershop</strong><br>Contenuti promozionali</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">📱</div>
                        <div class="label"><strong>App Pay-Per-Use</strong><br>Fatturazione automatica</div>
                    </div>
                    <div class="roi-stat">
                        <div class="number">📊</div>
                        <div class="label"><strong>Report Mensili</strong><br>Analytics e crescita</div>
                    </div>
                </div>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-top: 25px; text-align: center;">
                    <p><strong>🎁 Valore aggiunto partnership:</strong> Oltre al sistema pay-per-use, includi setup completo presenza digitale e contenuti fotografici professionali!</p>
                </div>
            </div>
        </div>

        <!-- Sezione Firma Digitale -->
        <div class="signature-section" id="signatureSection">
            <h2>✍️ Accettazione e Firma Digitale</h2>

            <div class="signature-content">
                <div class="acceptance-checkboxes">
                    <h4 style="color: #2c5aa0; margin-bottom: 20px; font-size: clamp(14px, 3vw, 18px);">Conferma di Accettazione</h4>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-terms" required>
                        <label for="accept-terms">
                           <strong>Accetto il sistema Pay-Per-Use</strong> con fatturazione automatica mensile basata sull'utilizzo reale dell'app F4DEZONE
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-starter" required>
                        <label for="accept-starter">
                            <strong>Confermo di iniziare con il piano STARTER</strong> a CHF 89/mese per 0-100 prenotazioni mensili
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-upgrade" required>
                        <label for="accept-upgrade">
                            <strong>Accetto gli upgrade automatici</strong> quando supero i limiti del piano corrente per evitare interruzioni del servizio
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-partnership" required>
                        <label for="accept-partnership">
                            <strong>Confermo la partnership completa</strong> che include 1 taglio/mese in cambio di design + poster, setup Gmail business, Google Business Profile, Google Ads, foto professionali e video barbershop
                        </label>
                    </div>
                </div>

                <div class="signature-canvas-container">
                    <h4 style="color: #2c5aa0; margin-bottom: 15px; font-size: clamp(14px, 3vw, 18px);">Firma Digitale</h4>
                    <p style="margin-bottom: 15px; color: #666; font-size: clamp(12px, 2.5vw, 14px);">
                        Disegna la tua firma nel riquadro sottostante usando il mouse o il dito su dispositivi touch
                    </p>

                    <canvas id="signatureCanvas" class="signature-canvas" width="500" height="200"></canvas>

                    <div class="signature-controls">
                        <button type="button" class="btn btn-clear" onclick="clearSignature()">
                            🗑️ Cancella Firma
                        </button>
                        <button type="button" class="btn btn-submit" id="submitBtn" onclick="submitProposal()" disabled>
                            ✅ Firma e Accetta Sistema Pay-Per-Use
                        </button>
                    </div>

                    <div class="signature-info">
                        <p><strong>📋 Informazioni:</strong> Firmando digitalmente questa proposta, accetti il sistema pay-per-use con fatturazione automatica. La firma ha lo stesso valore legale di una firma cartacea.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messaggio di Successo -->
        <div class="success-message" id="successMessage">
            <h2>🎉 Sistema Pay-Per-Use Attivato!</h2>
            <p>Grazie per aver accettato il sistema pay-per-use. Inizieremo con il piano STARTER a CHF 89/mese.</p>
            <p><strong>Ti abbiamo inviato una copia della proposta firmata via email. L'app F4DEZONE è già operativa e il billing automatico è attivo!</strong></p>
        </div>

        <!-- Anteprima Firma -->
        <div class="signature-preview" id="signaturePreview" style="display: none;">
            <h4>📋 Dettagli Firma Digitale</h4>
            <div class="signature-details">
                <div><strong>Data e Ora:</strong> <span id="signatureDate"></span></div>
                <div><strong>Cliente:</strong> F4DEZONE BARBERS - Santiago Prat</div>
                <div><strong>Sviluppatore:</strong> Domenico Riccio</div>
                <div><strong>Sistema:</strong> Pay-Per-Use</div>
                <div><strong>Piano Iniziale:</strong> STARTER (CHF 89/mese)</div>
                <div><strong>IP Address:</strong> <span id="clientIP"></span></div>
            </div>
            <div style="margin-top: 15px;">
                <strong>Firma:</strong><br>
                <img id="signatureImage" style="border: 1px solid #ddd; border-radius: 5px; max-width: 100%; height: auto;">
            </div>
        </div>

        <div class="cta-section">
            <h2>💫 Con questa soluzione, F4DEZONE paga solo per il successo che ottiene!</h2>
            <p>Sistema sviluppato da Domenico Riccio con Billing intelligente Stripe & Analytics avanzate</p>
            <div style="margin-top: 30px; font-size: clamp(16px, 4vw, 22px);">
                <strong>🚀 Crescita Automatica • 💰 Billing Intelligente • 📊 Monitoraggio Real-Time • 🤝 Partnership Completa</strong>
            </div>
        </div>

        <div class="contact-section">
            <h3>📞 Attivazione e Supporto</h3>
            <p style="font-size: clamp(16px, 3.5vw, 20px); margin-bottom: 15px;"><strong>Domenico Riccio</strong></p>
            <p>📱 WhatsApp: 076 781 01 94</p>
            <p>✉️ Email: info@dcreativo.ch</p>
            <p style="margin-top: 25px; color: #666; font-size: clamp(12px, 2.5vw, 14px);">Questa proposta è valida per 30 giorni dalla prima apertura.</p>
        </div>
    </div>

    <script>
        // 🚀 CONFIGURAZIONE F4DEZONE
        const CONFIG = {
            password: 'f4dezone2025',
            expiryDays: 30,
            apiEndpoint: getApiEndpoint(), // ✅ Rileva automaticamente
            testMode: false, // 🧪 MODALITÀ TEST ATTIVA
            clientEmail: 'info@dcreativo.ch', // 📧 EMAIL TEST
            clientEmailProd: 'd8572229@gmail.com' // 📧 EMAIL PRODUZIONE
        };

        // 🌐 RILEVA ENDPOINT API AUTOMATICAMENTE
        function getApiEndpoint() {
            const currentURL = window.location.href;

            // Locale (file://)
            if (currentURL.startsWith('file://')) {
                console.log('🏠 Rilevato testing locale - API simulata');
                return null; // Forza simulazione
            }

            // Vercel/dcreativo.ch
            if (currentURL.includes('dcreativo.ch') || currentURL.includes('vercel.app')) {
                console.log('🌐 Rilevato server Vercel - API reale');
                return '/api/send-proposal';
            }

            // Localhost/development
            if (currentURL.includes('localhost') || currentURL.includes('127.0.0.1')) {
                console.log('🛠️ Rilevato localhost - API simulata');
                return null;
            }

            // Default
            return '/api/send-proposal';
        }

        // 🔄 SISTEMA DI RESET PER TEST
        function resetProposal() {
            if (confirm('🔄 RESET PROPOSTA\n\nVuoi cancellare tutti i dati e ricominciare da capo?\n\nQuesto cancellerà:\n- Accesso salvato\n- Firma digitale\n- Timer\n\nContinuare?')) {
                localStorage.removeItem('f4dezone_access');
                localStorage.removeItem('f4dezone_signature');
                alert('✅ Proposta resettata! Ricarica la pagina per ricominciare.');
                location.reload();
            }
        }

        // 🔧 CONTROLLO PARAMETRI URL PER RESET
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);

            // Reset via URL: ?reset=true
            if (urlParams.get('reset') === 'true') {
                resetProposal();
                return;
            }

            // Test mode via URL: ?test=true
            if (urlParams.get('test') === 'true') {
                CONFIG.testMode = true;
                console.log('🧪 Modalità test attivata via URL');
            }
        }

        // 🎯 COMBINAZIONE TASTI PER RESET (Ctrl+Shift+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyR') {
                e.preventDefault();
                resetProposal();
            }
        });

        // Variabili globali
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let hasSignature = false;
        let timerInterval = null;
        let isExpired = false;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            checkUrlParams(); // ✅ Controlla parametri URL
            setupPasswordScreen();
            updateCurrentDate();

            // 🧪 TEST MODE: Mostra info di debug
            if (CONFIG.testMode) {
                console.log('🧪 MODALITÀ TEST ATTIVA');
                console.log('📧 Email cliente (test):', CONFIG.clientEmail);
                console.log('🔄 Reset: Ctrl+Shift+R oppure URL ?reset=true');

                // Aggiungi indicatore visivo test mode
                const testBanner = document.createElement('div');
                testBanner.innerHTML = '🧪 MODALITÀ TEST - Email inviata a: ' + CONFIG.clientEmail;
                testBanner.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0;
                    background: #9C27B0; color: white;
                    padding: 10px; text-align: center;
                    font-weight: bold; z-index: 20000; font-size: 14px;
                `;
                document.body.appendChild(testBanner);
            }

            if (localStorage.getItem('f4dezone_access')) {
                showProposal();
            }
        });

        // Setup schermata password
        function setupPasswordScreen() {
            const passwordInput = document.getElementById('passwordInput');
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        }

        // Controllo password
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorMessage = document.getElementById('errorMessage');

            if (password === CONFIG.password) {
                const accessData = {
                    firstAccess: Date.now(),
                    hasAccess: true,
                    testMode: CONFIG.testMode
                };
                localStorage.setItem('f4dezone_access', JSON.stringify(accessData));
                showProposal();
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        // Mostra la proposta
        function showProposal() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('proposalContainer').style.display = 'block';

            initializeSignature();
            checkStoredSignature();
            setupEventListeners();
            startTimer();
            animateElements();
        }

        // Aggiorna la data corrente
        function updateCurrentDate() {
            const now = new Date();
            const options = {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                timeZone: 'Europe/Zurich'
            };

            const formatter = new Intl.DateTimeFormat('it-IT', options);
            const currentDateFormatted = formatter.format(now);

            document.getElementById('currentDate').textContent = currentDateFormatted;
        }

        // Timer di 30 giorni
        function startTimer() {
            const accessData = JSON.parse(localStorage.getItem('f4dezone_access'));
            if (!accessData || !accessData.firstAccess) return;

            const firstAccess = new Date(accessData.firstAccess);
            const expiryDate = new Date(firstAccess.getTime() + (CONFIG.expiryDays * 24 * 60 * 60 * 1000));

            timerInterval = setInterval(function() {
                const now = new Date();
                const timeLeft = expiryDate - now;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showExpiredState();
                    return;
                }

                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('timerText').textContent = `${days}d ${hours}h ${minutes}m`;
            }, 60000);

            // Calcolo iniziale
            const now = new Date();
            const timeLeft = expiryDate - now;
            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('timerText').textContent = `${days}d ${hours}h ${minutes}m`;
            } else {
                showExpiredState();
            }
        }

        // Stato scaduto
        function showExpiredState() {
            isExpired = true;
            const timerDisplay = document.getElementById('timerDisplay');
            timerDisplay.classList.add('expired');
            timerDisplay.innerHTML = '⏰ <strong>PROPOSTA SCADUTA</strong> - Contatta Domenico Riccio per riattivare';

            const signatureSection = document.getElementById('signatureSection');
            if (signatureSection) {
                signatureSection.style.opacity = '0.5';
                signatureSection.style.pointerEvents = 'none';
            }
        }

        // Inizializza canvas firma
        function initializeSignature() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');

            ctx.strokeStyle = '#2c5aa0';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        // Eventi touch per mobile
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            if (e.type === 'touchstart') {
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(x, y);
            } else if (e.type === 'touchmove' && isDrawing) {
                ctx.lineTo(x, y);
                ctx.stroke();
                hasSignature = true;
                checkFormValidity();
            }
        }

        function startDrawing(e) {
            if (isExpired) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing || isExpired) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            hasSignature = true;
            checkFormValidity();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearSignature() {
            if (isExpired) return;
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
            checkFormValidity();
        }

        // Event listeners
        function setupEventListeners() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', checkFormValidity);
            });
        }

        // Controllo validità form
        function checkFormValidity() {
            const checkboxes = document.querySelectorAll('#signatureSection input[type="checkbox"]');

            let allChecked = true;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });

            const submitBtn = document.getElementById('submitBtn');
            const isFormValid = allChecked && hasSignature && !isExpired;

            submitBtn.disabled = !isFormValid;

            if (isFormValid) {
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // Controlla firma salvata
        function checkStoredSignature() {
            const storedData = localStorage.getItem('f4dezone_signature');
            if (storedData) {
                const signatureData = JSON.parse(storedData);
                showSignedState(signatureData);
            }
        }

        // Mostra stato firmato
        function showSignedState(signatureData) {
            document.getElementById('statusBanner').style.display = 'block';
            document.getElementById('signatureSection').style.display = 'none';

            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('show');

            setTimeout(() => {
                const preview = document.getElementById('signaturePreview');
                preview.style.display = 'block';

                document.getElementById('signatureDate').textContent = signatureData.timestamp;
                document.getElementById('clientIP').textContent = signatureData.ipAddress || 'N/A';
                document.getElementById('signatureImage').src = signatureData.signatureData;

                preview.style.opacity = '0';
                preview.style.transform = 'translateY(20px)';
                preview.style.transition = 'all 0.5s ease-out';

                setTimeout(() => {
                    preview.style.opacity = '1';
                    preview.style.transform = 'translateY(0)';
                }, 100);
            }, 500);

            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    successMessage.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }, 200);
            }
        }

        // Genera PDF
       // 📄 GENERA PDF PROFESSIONALE - VERSIONE F4DEZONE
        // 📄 GENERA PDF PROFESSIONALE - VERSIONE F4DEZONE
        async function generatePDF() {
    return new Promise(async (resolve, reject) => {
        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4',
                compress: true
            });

            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 15;
            const contentWidth = pageWidth - (margin * 2);
            let currentY = margin;

            // 🎨 FUNZIONI HELPER PER LAYOUT COERENTE
            function addText(text, x, y, options = {}) {
                const fontSize = options.fontSize || 10;
                const fontStyle = options.fontStyle || 'normal';
                const align = options.align || 'left';
                const maxWidth = options.maxWidth || contentWidth;
                const color = options.color || [0, 0, 0];

                pdf.setFontSize(fontSize);
                pdf.setFont('helvetica', fontStyle);
                pdf.setTextColor(color[0], color[1], color[2]);

                if (align === 'center') {
                    x = pageWidth / 2;
                } else if (align === 'right') {
                    x = pageWidth - margin;
                }

                if (text.length > 80 && maxWidth) {
                    const lines = pdf.splitTextToSize(text, maxWidth);
                    pdf.text(lines, x, y, { align: align });
                    return y + (lines.length * fontSize * 0.4);
                } else {
                    pdf.text(text, x, y, { align: align });
                    return y + (fontSize * 0.4);
                }
            }

            function addSection(title, yPosition) {
                checkPageBreak(15);

                // Header colorato per sezione
                pdf.setFillColor(44, 90, 160);
                pdf.rect(margin, yPosition - 5, contentWidth, 8, 'F');

                // Titolo sezione in bianco
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'bold');
                pdf.text(title, margin + 3, yPosition, { align: 'left' });

                return yPosition + 15;
            }

            function checkPageBreak(neededSpace) {
                if (currentY + neededSpace > pageHeight - 25) {
                    pdf.addPage();
                    currentY = margin;
                    return true;
                }
                return false;
            }

            function addPricingPlan(plan, yPosition) {
                checkPageBreak(25);

                // Background del piano
                pdf.setFillColor(248, 249, 250);
                pdf.rect(margin, yPosition - 3, contentWidth, 22, 'F');

                // Nome e range del piano
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(44, 90, 160);
                pdf.text(`${plan.name} - ${plan.range}`, margin + 3, yPosition + 2);

                // Prezzo
                pdf.setTextColor(76, 175, 80);
                pdf.text(plan.price, pageWidth - margin - 3, yPosition + 2, { align: 'right' });

                // Features
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(85, 85, 85);

                let featY = yPosition + 7;
                plan.features.slice(0, 3).forEach(feature => {
                    pdf.text(`• ${feature}`, margin + 6, featY);
                    featY += 3.5;
                });

                return yPosition + 25;
            }

            // 🎯 HEADER PRINCIPALE
            pdf.setFillColor(44, 90, 160);
            pdf.rect(0, 0, pageWidth, 25, 'F');

            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(20);
            pdf.setFont('helvetica', 'bold');
            pdf.text('F4DEZONE - SISTEMA PAY-PER-USE', pageWidth/2, 12, { align: 'center' });

            pdf.setFontSize(12);
            pdf.text('Abbonamento Dinamico Basato sull\'Utilizzo Reale', pageWidth/2, 18, { align: 'center' });

            currentY = 35;

            // 🏢 INFORMAZIONI AZIENDE
            pdf.setTextColor(0, 0, 0);

            // Colonna sinistra - Sviluppatore
            let leftY = currentY;
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text('Domenico Riccio', margin, leftY);

            leftY += 6;
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'normal');
            pdf.text('Full-Stack Developer - Web & App Solutions', margin, leftY);

            leftY += 4;
            pdf.text('Via Ol Mött 6, 6703 Osogna, Svizzera', margin, leftY);

            leftY += 4;
            pdf.text('Tel: 076 781 01 94 | Email: info@dcreativo.ch', margin, leftY);

            // Colonna destra - Cliente
            let rightY = currentY;
            const rightX = pageWidth - margin;

            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text('F4DEZONE BARBERS', rightX, rightY, { align: 'right' });

            rightY += 6;
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'normal');
            pdf.text('Santiago Prat - Proprietario', rightX, rightY, { align: 'right' });

            rightY += 4;
            pdf.text('Via Zurigo 2, 6900 Lugano', rightX, rightY, { align: 'right' });

            rightY += 4;
            pdf.text('Tel: +41 78 930 15 99', rightX, rightY, { align: 'right' });

            rightY += 4;
            const today = new Date().toLocaleDateString('it-IT');
            pdf.text(`Data: ${today}`, rightX, rightY, { align: 'right' });

            currentY = Math.max(leftY, rightY) + 15;

            // 📋 PIANI DI UTILIZZO
            currentY = addSection('PIANI DI UTILIZZO DINAMICI', currentY);

            const plans = [
                {
                    name: 'STARTER',
                    price: 'CHF 89/mese',
                    range: '0-100 prenotazioni/mese',
                    features: ['Fino a 100 prenotazioni', '500 email automatiche', '100 SMS promemoria']
                },
                {
                    name: 'BUSINESS',
                    price: 'CHF 149/mese',
                    range: '101-300 prenotazioni/mese',
                    features: ['Fino a 300 prenotazioni', '1,500 email automatiche', '300 SMS promemoria']
                },
                {
                    name: 'PREMIUM',
                    price: 'CHF 249/mese',
                    range: '301-1000 prenotazioni/mese',
                    features: ['Fino a 1,000 prenotazioni', 'Email illimitate', '1,000 SMS promemoria']
                },
                {
                    name: 'ENTERPRISE',
                    price: 'CHF 0.25 per prenotazione',
                    range: 'oltre le 1000',
                    features: ['Prenotazioni illimitate', 'Tutti i servizi inclusi', 'Account manager dedicato']
                }
            ];

            plans.forEach(plan => {
                currentY = addPricingPlan(plan, currentY);
            });

            // 🤝 PARTNERSHIP PERSONALIZZATA
            checkPageBreak(50);
            currentY += 10;
            currentY = addSection('PARTNERSHIP PERSONALIZZATA COMPLETA', currentY);

            // Nota sui tagli precedenti
            pdf.setFillColor(255, 243, 205);
            pdf.rect(margin, currentY - 2, contentWidth, 8, 'F');
            pdf.setFontSize(9);
            pdf.setTextColor(102, 102, 102);
            pdf.text('Nota: I 5 tagli già effettuati sono stati il pagamento per il lavoro precedente', margin + 3, currentY + 2);
            currentY += 12;

            // Servizi partnership
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(44, 90, 160);
            pdf.text('🤝 Servizi Partnership Inclusi:', margin + 3, currentY);
            currentY += 8;

            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(85, 85, 85);

            const partnershipServices = [
                '✂️ 1 taglio completo/mese in cambio di design e poster',
                '📧 Setup Gmail Business con account professionale',
                '🗺️ Google Business Profile con ottimizzazione completa',
                '🎯 Setup Google Ads con campagne ottimizzate',
                '📸 Foto professionali barbers + ambiente barbershop',
                '🎬 Video promozionali barbershop',
                '📱 App pay-per-use con fatturazione automatica Stripe',
                '📊 Report mensili con analytics e crescita'
            ];

            partnershipServices.forEach(service => {
                checkPageBreak(5);
                pdf.text(`• ${service}`, margin + 6, currentY);
                currentY += 5;
            });

            currentY += 10;

            // ✅ VANTAGGI PAY-PER-USE (UNA VOLTA SOLA)
            checkPageBreak(35);
            currentY = addSection('VANTAGGI SOLUZIONE PAY-PER-USE', currentY);

            pdf.setFillColor(227, 242, 253);
            pdf.rect(margin, currentY - 3, contentWidth, 30, 'F');

            pdf.setFontSize(10);
            pdf.setTextColor(0, 0, 0);

            const advantages = [
                'Start a CHF 89/mese invece di CHF 295',
                'Crescita graduale dei costi con il business',
                'Nessun rischio di sovra-pagamento',
                'Trasparenza totale sui costi',
                'Scala automaticamente con il successo'
            ];

            advantages.forEach(advantage => {
                pdf.text(`✓ ${advantage}`, margin + 6, currentY);
                currentY += 5;
            });

            currentY += 10;

            // 📊 ROI ANALYSIS
            checkPageBreak(25);
            currentY = addSection('ROI ANALYSIS', currentY);

            pdf.setFontSize(10);
            pdf.setTextColor(0, 0, 0);
            pdf.text('Prenotazione media: CHF 35', margin + 3, currentY);
            currentY += 5;
            pdf.text('300 prenotazioni/mese = CHF 10,500 fatturato', margin + 3, currentY);
            currentY += 5;
            pdf.text('Costo app: CHF 149/mese (1.4% del fatturato)', margin + 3, currentY);
            currentY += 5;
            pdf.text('ROI: 98.6% profitto netto', margin + 3, currentY);
            currentY += 15;

            // ✍️ SEZIONE FIRMA
            checkPageBreak(50);
            currentY = addSection('ACCETTAZIONE SISTEMA PAY-PER-USE', currentY);

            // Box firma
            pdf.setFillColor(255, 255, 255);
            pdf.rect(margin, currentY, contentWidth, 35, 'F');
            pdf.setDrawColor(44, 90, 160);
            pdf.rect(margin, currentY, contentWidth, 35);

            const signatureDate = new Date().toLocaleString('it-IT');
            currentY += 8;
            pdf.setFontSize(10);
            pdf.setTextColor(0, 0, 0);
            pdf.text(`Data e Ora Firma: ${signatureDate}`, margin + 5, currentY);
            currentY += 5;
            pdf.text('Cliente: F4DEZONE BARBERS - Santiago Prat', margin + 5, currentY);
            currentY += 5;
            pdf.text('Sviluppatore: Domenico Riccio', margin + 5, currentY);
            currentY += 5;
            pdf.text('Sistema: Pay-Per-Use con piano iniziale STARTER', margin + 5, currentY);

            // Aggiungi firma se presente
            if (hasSignature && canvas) {
                try {
                    const signatureImageData = canvas.toDataURL('image/png', 1.0);
                    const signatureWidth = 60;
                    const signatureHeight = 20;
                    const signatureX = pageWidth - margin - signatureWidth - 5;
                    const signatureY = currentY - 15;

                    pdf.addImage(signatureImageData, 'PNG', signatureX, signatureY, signatureWidth, signatureHeight);

                    pdf.setFontSize(8);
                    pdf.setTextColor(102, 102, 102);
                    pdf.text('Firma Digitale Cliente', signatureX + signatureWidth/2, signatureY + signatureHeight + 4, { align: 'center' });
                } catch (error) {
                    console.error('Errore aggiunta firma al PDF:', error);
                    pdf.setFontSize(10);
                    pdf.setTextColor(76, 175, 80);
                    pdf.text('[FIRMA DIGITALE PRESENTE]', pageWidth - margin - 5, currentY, { align: 'right' });
                }
            }

            currentY += 20;

            // 🧪 TEST MODE INDICATOR (solo se necessario)
            if (CONFIG.testMode) {
                checkPageBreak(15);
                pdf.setFillColor(156, 39, 176);
                pdf.rect(margin, currentY, contentWidth, 8, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text('🧪 MODALITÀ TEST - Email inviata a: ' + CONFIG.clientEmail, margin + 3, currentY + 5);
                currentY += 15;
            }

            // 🎯 FOOTER PROFESSIONALE
            const footerY = pageHeight - 20;
            pdf.setFillColor(44, 90, 160);
            pdf.rect(0, footerY, pageWidth, 20, 'F');

            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(10);
            pdf.text('Domenico Riccio - Full-Stack Developer - Web & App Solutions', pageWidth/2, footerY + 8, { align: 'center' });
            pdf.setFontSize(8);
            pdf.text('Tel: 076 781 01 94 | Email: info@dcreativo.ch | Web: dcreativo.ch', pageWidth/2, footerY + 14, { align: 'center' });

            console.log('✅ PDF F4DEZONE generato con layout professionale');
            resolve(pdf);

        } catch (error) {
            console.error('❌ Errore generazione PDF:', error);
            reject(error);
        }
    });
}

        // 📧 INVIO EMAIL TRAMITE API - VERSIONE COMPATIBILE CON TESTING LOCALE
        async function sendProposalEmail(emailData) {
            try {
                console.log('📧 Invio email tramite API universale...');
                console.log('📊 Dati firma:', {
                    date: emailData.signatureData.date,
                    cliente: 'F4DEZONE BARBERS - Santiago Prat',
                    sistema: 'Pay-Per-Use - Piano STARTER',
                    email: CONFIG.testMode ? CONFIG.clientEmail : CONFIG.clientEmailProd
                });

                // 🏠 TESTING LOCALE: Simula sempre successo
                if (!CONFIG.apiEndpoint) {
                    console.log('🏠 Testing locale rilevato - Simulazione invio email');
                    await new Promise(resolve => setTimeout(resolve, 1500)); // Simula delay API

                    return {
                        success: true,
                        clientMessageId: 'local-test-client-' + Date.now(),
                        developerMessageId: 'local-test-dev-' + Date.now(),
                        contractReference: 'F4D-LOCAL-' + Date.now().toString().slice(-6),
                        billingStart: 'Piano STARTER - CHF 89/mese (Test Locale)',
                        testMode: true,
                        type: 'f4dezone_payperuse',
                        localTest: true
                    };
                }

                // 🎯 DATI COMPATIBILI CON API UNIVERSALE
                const apiData = {
                    type: 'f4dezone_payperuse', // ✅ Identificativo per routing
                    signatureData: {
                        date: emailData.signatureData.date,
                        timestamp: emailData.signatureData.timestamp,
                        clientIP: emailData.signatureData.ipAddress,
                        cliente: 'F4DEZONE BARBERS - Santiago Prat',
                        sviluppatore: 'Domenico Riccio',
                        sistema: 'Pay-Per-Use - Piano STARTER',
                        partnership: '1 taglio/mese + servizi digitali completi'
                    },
                    pdfBase64: emailData.pdfBase64,
                    emailCliente: CONFIG.testMode ? CONFIG.clientEmail : CONFIG.clientEmailProd,
                    emailSviluppatore: 'info@dcreativo.ch',
                    testMode: CONFIG.testMode
                };

                console.log('🎯 Invio a API universale su server...');
                console.log('📧 Email cliente:', apiData.emailCliente);
                console.log('🧪 Test Mode:', apiData.testMode);

                // 🌐 Chiamata API Reale su Server
                const response = await fetch(CONFIG.apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'F4DEZONE-PayPerUse/1.0'
                    },
                    body: JSON.stringify(apiData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log('✅ F4DEZONE Pay-Per-Use attivato su server!');
                    console.log('📧 Email cliente ID:', result.clientMessageId);
                    console.log('📧 Email sviluppatore ID:', result.developerMessageId);
                    console.log('🎯 Contratto:', result.contractReference);
                    console.log('💰 Billing:', result.billingStart);
                    console.log('🧪 Test Mode:', result.testMode);
                    return result;
                } else {
                    throw new Error(result.error || 'Errore attivazione sistema pay-per-use');
                }

            } catch (error) {
                console.error('❌ Errore sistema pay-per-use:', error);

                // 🧪 IN MODALITÀ TEST: Non bloccare, simula successo
                if (CONFIG.testMode) {
                    console.log('🧪 TEST MODE: Simulo attivazione riuscita per fallback');
                    return {
                        success: true,
                        clientMessageId: 'test-fallback-client-' + Date.now(),
                        developerMessageId: 'test-fallback-dev-' + Date.now(),
                        contractReference: 'F4D-TEST-FB-' + Date.now().toString().slice(-6),
                        billingStart: 'Piano STARTER - CHF 89/mese (Test Fallback)',
                        testMode: true,
                        type: 'f4dezone_payperuse',
                        fallback: true
                    };
                }

                // Gestione errori in produzione
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Errore di connessione. Verifica la connessione internet e riprova.');
                } else if (error.message.includes('500')) {
                    throw new Error('Errore server. Riprova tra qualche minuto o contatta il supporto.');
                } else if (error.message.includes('404')) {
                    throw new Error('Servizio email non disponibile. Contatta il supporto.');
                } else {
                    throw new Error(`Errore attivazione sistema: ${error.message}`);
                }
            }
        }

        // 🚀 SOTTOMISSIONE PROPOSTA - VERSIONE COMPLETA
        async function submitProposal() {
            if (!hasSignature || isExpired) return;

            const checkboxes = document.querySelectorAll('#signatureSection input[type="checkbox"]');
            let allChecked = true;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });

            if (!allChecked) {
                alert('⚠️ Completa tutti i campi richiesti prima di firmare');
                return;
            }

            document.getElementById('loadingScreen').style.display = 'flex';

            try {
                console.log('🚀 Inizio processo firma e invio...');

                const signatureData = {
                    date: new Date().toLocaleString('it-IT'),
                    timestamp: new Date().toLocaleString('it-IT'),
                    signatureData: canvas.toDataURL('image/png'),
                    ipAddress: await getClientIP(),
                    userAgent: navigator.userAgent,
                    system: 'pay-per-use',
                    startingPlan: 'STARTER',
                    testMode: CONFIG.testMode,
                    checkboxStates: {
                        terms: document.getElementById('accept-terms').checked,
                        starter: document.getElementById('accept-starter').checked,
                        upgrade: document.getElementById('accept-upgrade').checked,
                        partnership: document.getElementById('accept-partnership').checked
                    }
                };

                // 💾 Salva nel localStorage
                localStorage.setItem('f4dezone_signature', JSON.stringify(signatureData));

                // 📄 Genera PDF
                console.log('📄 Generazione PDF di alta qualità...');
                const pdf = await generatePDF();
                const pdfBlob = pdf.output('blob');
                const pdfDataUri = pdf.output('datauristring');
                const pdfBase64Pure = pdfDataUri.split(',')[1];

                console.log('✅ PDF generato - Dimensione:', Math.round(pdfBlob.size / 1024), 'KB');

                // 📧 Invia email
                console.log('📧 Invio email con PDF...');
                const emailData = {
                    signatureData: signatureData,
                    pdfBase64: pdfBase64Pure
                };

                const emailResult = await sendProposalEmail(emailData);

                // 📥 Download automatico PDF
                console.log('📥 Download automatico PDF...');
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(pdfBlob);
                downloadLink.download = `F4DEZONE_PayPerUse_Firmato_${new Date().toISOString().split('T')[0]}.pdf`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                setTimeout(() => URL.revokeObjectURL(downloadLink.href), 1000);

                // 🎉 Mostra successo
                document.getElementById('loadingScreen').style.display = 'none';
                showSignedState(signatureData);

                console.log('✅ Sistema pay-per-use F4DEZONE attivato con successo!');
                console.log('📧 Email cliente inviata:', emailResult.clientMessageId);
                console.log('📧 Email sviluppatore inviata:', emailResult.developerMessageId);
                console.log('🎯 Contratto:', emailResult.contractReference);
                console.log('💰 Billing:', emailResult.billingStart);

                // 🧪 Log modalità test
                if (CONFIG.testMode) {
                    if (emailResult.localTest) {
                        console.log('🏠 TEST LOCALE COMPLETATO - Email simulate (nessun invio reale)');
                        console.log('🚀 Per test email reali, deploya su dcreativo.ch/f4dezone');
                    } else if (emailResult.fallback) {
                        console.log('🧪 TEST FALLBACK COMPLETATO - Errore API, simulazione attivata');
                    } else {
                        console.log('🧪 TEST SERVER COMPLETATO - Email inviate a:', CONFIG.clientEmail);
                    }
                    console.log('🔄 Per resettare: Ctrl+Shift+R');
                }

            } catch (error) {
                console.error('❌ Errore sistema pay-per-use:', error);
                document.getElementById('loadingScreen').style.display = 'none';

                let errorMessage = '❌ Errore durante l\'attivazione del sistema pay-per-use.';

                if (error.message.includes('connessione')) {
                    errorMessage = '❌ Errore di connessione. Verifica la tua connessione internet e riprova.';
                } else if (error.message.includes('server')) {
                    errorMessage = '❌ Errore del server. Riprova tra qualche minuto.';
                } else if (error.message.includes('email')) {
                    errorMessage = '❌ Errore invio email. Il sistema è stato attivato ma l\'email potrebbe non essere stata inviata.';
                } else if (error.message.includes('PDF')) {
                    errorMessage = '❌ Errore generazione PDF. Riprova o contatta il supporto.';
                }

                alert(errorMessage + '\n\nSe il problema persiste, contatta:\n📞 076 781 01 94\n📧 info@dcreativo.ch');
            }
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'N/A';
            }
        }

        function animateElements() {
            const sections = document.querySelectorAll('.section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeInUp 0.6s ease-out forwards';
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => {
                observer.observe(section);
            });
        }

        // 🎯 LOG FINALE CON AUTO-DETECT
        console.log('🚀 F4DEZONE Pay-Per-Use System - READY');
        console.log('⏰ Timer di scadenza: 30 giorni dal primo accesso');
        console.log('🔐 Password: f4dezone2025');
        console.log('📧 Email cliente (test):', CONFIG.clientEmail);
        console.log('💰 Piano iniziale: STARTER - CHF 89/mese');
        console.log('🤝 Partnership: 1 taglio/mese + servizi digitali completi');
        console.log('🔄 Reset: Ctrl+Shift+R oppure URL ?reset=true');
        console.log('🧪 Test mode:', CONFIG.testMode ? 'ATTIVO' : 'DISATTIVO');
        console.log('🌐 API Endpoint:', CONFIG.apiEndpoint || 'SIMULATO (testing locale)');

        // Info testing
        if (!CONFIG.apiEndpoint) {
            console.log('📝 NOTA: Testing locale - Email simulate senza invio reale');
            console.log('🚀 Per test email reali, deploya su dcreativo.ch/f4dezone');
        }
    </script>
</body>
</html>
