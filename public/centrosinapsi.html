<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Centro Sinapsi - Proposta Sviluppo</title>
    <meta name="description" content="Proposta sviluppo Progressive Web Application per Centro Sinapsi - Domenico Riccio Web & App Solutions">
    <meta name="robots" content="noindex, nofollow">

    <!-- jsPDF per generazione PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-card h2 {
            color: #2c5aa0;
            margin-bottom: 30px;
            font-size: clamp(22px, 5vw, 28px);
        }

        .login-card p {
            color: #666;
            margin-bottom: 30px;
            font-size: clamp(14px, 3vw, 16px);
        }

        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: clamp(14px, 3vw, 16px);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(44, 90, 160, 0.3);
        }

        .error-message {
            color: #ff6b35;
            margin-top: 15px;
            font-size: clamp(12px, 2.5vw, 14px);
            display: none;
        }

        /* Timer Display */
        .timer-display {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 15px;
            text-align: center;
            margin: -20px -20px 30px -20px;
            font-weight: bold;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .timer-display.expired {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2c5aa0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #2c5aa0;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2c5aa0, #4CAF50);
        }

        .status-banner {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 15px;
            text-align: center;
            margin: -20px -20px 30px -20px;
            font-weight: bold;
            display: none;
        }

        .status-banner.signed {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: block;
        }

        .header {
            background: white;
            color: #333;
            border-bottom: 4px solid #2c5aa0;
            padding-bottom: 25px;
            margin-bottom: 40px;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .company-info h1 {
            color: #2c5aa0;
            font-size: clamp(24px, 5vw, 32px);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .company-info .tagline {
            font-size: clamp(14px, 3vw, 18px);
            color: #333;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .company-info p, .client-info p {
            font-size: clamp(12px, 2.5vw, 14px);
            margin-bottom: 3px;
            color: #333;
        }

        .client-info {
            text-align: right;
        }

        .client-info h2 {
            color: #2c5aa0;
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 8px;
        }

        .app-title {
            text-align: center;
            margin: 40px 0;
            padding: 40px 20px;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.3);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .app-title:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(44, 90, 160, 0.4);
        }

        .app-title h1 {
            font-size: clamp(28px, 6vw, 42px);
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .app-title p {
            font-size: clamp(16px, 4vw, 22px);
            opacity: 0.95;
        }

        .section {
            margin-bottom: 50px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section h2 {
            color: #2c5aa0;
            font-size: clamp(18px, 4vw, 26px);
            margin-bottom: 25px;
            border-bottom: 3px solid #e3f2fd;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .section h2::before {
            content: "▶";
            margin-right: 15px;
            color: #4CAF50;
            font-size: 0.8em;
        }

        .services-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin: 30px 0;
        }

        .service-category {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #2c5aa0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .service-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #2c5aa0, #4CAF50);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .service-category:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .service-category:hover::before {
            transform: scaleX(1);
        }

        .service-category h3 {
            color: #2c5aa0;
            margin-bottom: 20px;
            font-size: clamp(16px, 3.5vw, 22px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .service-price {
            color: #4CAF50;
            font-weight: bold;
            font-size: clamp(16px, 3.5vw, 20px);
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #4CAF50;
        }

        .service-list {
            list-style: none;
            padding: 0;
        }

        .service-list li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
            color: #555;
            font-size: clamp(13px, 2.8vw, 15px);
            line-height: 1.5;
            transition: color 0.2s ease;
        }

        .service-list li:hover {
            color: #2c5aa0;
        }

        .service-list li::before {
            content: "✓";
            color: #4CAF50;
            font-weight: bold;
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }

        .tech-stack {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 35px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(44, 90, 160, 0.1);
        }

        .tech-stack h3 {
            color: #2c5aa0;
            margin-bottom: 20px;
            font-size: clamp(16px, 3.5vw, 20px);
            text-align: center;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .tech-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #2c5aa0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tech-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(44, 90, 160, 0.2);
            border-color: #4CAF50;
        }

        .tech-item h4 {
            color: #2c5aa0;
            margin-bottom: 8px;
            font-size: clamp(12px, 2.5vw, 16px);
        }

        .tech-item p {
            font-size: clamp(11px, 2vw, 13px);
            color: #666;
        }

        .pricing-summary {
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .pricing-summary h3 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 30px;
            font-size: clamp(18px, 4vw, 24px);
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .price-table th {
            background: linear-gradient(135deg, #2c5aa0, #1e4080);
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-size: clamp(14px, 3vw, 16px);
        }

        .price-table td {
            padding: 18px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .price-table .service-name {
            font-weight: 600;
            color: #333;
        }

        .price-table .price {
            text-align: right;
            font-weight: bold;
            color: #2c5aa0;
        }

        .total-row {
            background: linear-gradient(135deg, #f0f7ff, #e3f2fd);
            font-weight: bold;
            font-size: clamp(14px, 3vw, 18px);
        }

        .discount-row {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            color: #4CAF50;
            font-weight: bold;
            font-size: clamp(14px, 3vw, 18px);
        }

        .final-row {
            background: linear-gradient(135deg, #2c5aa0, #1e4080);
            color: white;
            font-weight: bold;
            font-size: clamp(16px, 3.5vw, 20px);
        }

        .discount-highlight {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }

        .discount-highlight h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: clamp(16px, 3.5vw, 20px);
        }

        .timeline-section {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 35px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .timeline-section h3 {
            color: #2c5aa0;
            margin-bottom: 25px;
            font-size: clamp(16px, 3.5vw, 20px);
            text-align: center;
        }

        .timeline-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid #2c5aa0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .timeline-item .week {
            background: linear-gradient(135deg, #2c5aa0, #1e4080);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-right: 20px;
            min-width: 120px;
            text-align: center;
            font-size: clamp(12px, 2.5vw, 14px);
            flex-shrink: 0;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-content strong {
            color: #2c5aa0;
            font-size: clamp(14px, 3vw, 16px);
        }

        .payment-options {
            background: linear-gradient(135deg, #f0f7ff, #e3f2fd);
            padding: 35px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(44, 90, 160, 0.1);
        }

        .payment-options h3 {
            color: #2c5aa0;
            margin-bottom: 25px;
            font-size: clamp(16px, 3.5vw, 20px);
            text-align: center;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .payment-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #4CAF50;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            position: relative;
        }

        .payment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.2);
        }

        .payment-card.selected {
            border-color: #2c5aa0;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.3);
        }

        .payment-card-full {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #4CAF50;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            margin-top: 25px;
            position: relative;
        }

        .payment-card-full.selected {
            border-color: #2c5aa0;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.3);
        }

        .payment-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .payment-badge.extended {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .total-payment-row {
            background: linear-gradient(135deg, #2c5aa0, #1e4080) !important;
            color: white !important;
            font-weight: bold !important;
        }

        .total-payment-row td {
            color: white !important;
            font-weight: bold !important;
        }

        .custom-payment-section {
            margin-top: 20px;
        }

        .custom-payment-intro {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #2c5aa0;
        }

        .custom-payment-intro p {
            margin-bottom: 10px;
            font-size: clamp(13px, 2.8vw, 15px);
            line-height: 1.5;
        }

        .custom-payment-intro p:last-child {
            margin-bottom: 0;
        }

        .custom-payment-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c5aa0;
            margin-bottom: 8px;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .form-input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: clamp(14px, 3vw, 16px);
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .form-input:invalid {
            border-color: #ff6b35;
        }

        .form-group small {
            font-size: clamp(11px, 2.2vw, 12px);
            color: #666;
            margin-top: 5px;
        }

        .calculation-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
            margin-top: 20px;
        }

        .calculation-table {
            margin-bottom: 15px;
        }

        .validation-message {
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .validation-message.valid {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .validation-message.invalid {
            background: linear-gradient(135deg, #ffebee, #fce4ec);
            color: #f44336;
            border: 2px solid #f44336;
        }

        .custom-payment-footer {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #2c5aa0;
        }

        .payment-card h4 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: clamp(14px, 3vw, 18px);
        }

        .payment-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payment-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: clamp(12px, 2.5vw, 14px);
        }

        .cta-section {
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            padding: 50px 30px;
            border-radius: 20px;
            text-align: center;
            margin: 50px 0;
            box-shadow: 0 20px 50px rgba(44, 90, 160, 0.3);
        }

        .cta-section h2 {
            font-size: clamp(20px, 5vw, 32px);
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cta-section p {
            font-size: clamp(14px, 3vw, 18px);
            margin-bottom: 15px;
            opacity: 0.95;
        }

        /* Sezione Firma Digitale */
        .signature-section {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 40px;
            border-radius: 20px;
            margin: 50px 0;
            border: 3px solid #2c5aa0;
            box-shadow: 0 15px 40px rgba(44, 90, 160, 0.15);
        }

        .signature-section h2 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 30px;
            font-size: clamp(20px, 4.5vw, 28px);
        }

        .signature-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .acceptance-checkboxes {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #4CAF50;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            font-size: clamp(13px, 2.8vw, 15px);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: #4CAF50;
            margin-top: 2px;
        }

        .checkbox-item label {
            cursor: pointer;
            line-height: 1.5;
            color: #333;
        }

        .signature-canvas-container {
            background: white;
            border: 3px dashed #2c5aa0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .signature-canvas {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: crosshair;
            width: 100%;
            max-width: 500px;
            height: 200px;
            background: #fafafa;
        }

        .signature-controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(13px, 2.8vw, 15px);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-clear {
            background: #ff6b35;
            color: white;
        }

        .btn-clear:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        .btn-submit {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 40px;
            font-size: clamp(15px, 3vw, 18px);
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .signature-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: clamp(12px, 2.5vw, 14px);
            color: #666;
            text-align: center;
        }

        .success-message {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            display: none;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);
        }

        .success-message.show {
            display: block;
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .signature-preview {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #4CAF50;
            margin-top: 20px;
        }

        .signature-preview h4 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: clamp(14px, 3vw, 16px);
        }

        .signature-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            font-size: clamp(12px, 2.5vw, 14px);
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.2);
        }

        .info-box h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: clamp(16px, 3.5vw, 20px);
        }

        .contact-section {
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .contact-section h3 {
            color: #2c5aa0;
            margin-bottom: 25px;
            font-size: clamp(18px, 4vw, 24px);
        }

        .contact-section p {
            font-size: clamp(14px, 3vw, 18px);
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
                border-radius: 10px;
            }

            .header {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }

            .client-info {
                text-align: center;
            }

            .service-category h3 {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .tech-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .payment-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .custom-payment-form {
                padding: 20px;
            }

            .timeline-item {
                flex-direction: column;
                text-align: center;
            }

            .timeline-item .week {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .signature-controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }
        }

        @media (max-width: 480px) {
            .app-title {
                padding: 25px 15px;
            }

            .section {
                margin-bottom: 30px;
            }

            .service-category,
            .tech-stack,
            .pricing-summary,
            .timeline-section,
            .payment-options,
            .signature-section {
                padding: 20px;
            }

            .payment-card,
            .payment-card-full {
                padding: 20px;
            }

            .custom-payment-form {
                padding: 15px;
            }

            .custom-payment-intro {
                padding: 15px;
            }

            .form-input {
                padding: 10px 12px;
            }

            .payment-badge {
                font-size: 10px;
                padding: 6px 12px;
                right: 15px;
            }

            .price-table th,
            .price-table td {
                padding: 12px 8px;
            }
        }

        /* Print styles mantengono le ottimizzazioni precedenti */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                margin: 12mm !important;
                size: A4 !important;
            }

            body {
                background: white !important;
                padding: 0 !important;
                font-size: 11px !important;
                line-height: 1.4 !important;
                margin: 0 !important;
            }

            .container {
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 !important;
                background: white !important;
            }

            .signature-section,
            .success-message,
            .timer-display {
                display: none !important;
            }

            .header {
                background: white !important;
                color: #333 !important;
                margin-bottom: 5px !important;
                padding: 15px 0 5px 0 !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                border-bottom: 2px solid #2c5aa0 !important;
                keep-with-next: always !important;
                grid-template-columns: 1fr 1fr !important;
            }

            .app-title {
                margin: 0 0 15px 0 !important;
                padding: 15px !important;
                page-break-inside: avoid !important;
                page-break-before: avoid !important;
                page-break-after: avoid !important;
                break-inside: avoid !important;
                break-before: avoid !important;
                break-after: avoid !important;
                border-radius: 8px !important;
            }

            .section {
                margin-bottom: 20px !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .service-category,
            .tech-stack,
            .pricing-summary,
            .timeline-section,
            .payment-options {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin-bottom: 15px !important;
                padding: 12px !important;
            }

            .header + .app-title {
                page-break-before: avoid !important;
                break-before: avoid !important;
            }

            h1, h2, h3, h4 {
                page-break-after: avoid !important;
                break-after: avoid !important;
                orphans: 3 !important;
                widows: 3 !important;
                keep-with-next: always !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h2>🔐 Accesso Riservato</h2>
            <p>Proposta Centro Sinapsi PWA<br>Inserisci la password per accedere</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="Password" />
            <button class="login-btn" onclick="checkPassword()">🚀 Accedi alla Proposta</button>
            <div class="error-message" id="errorMessage">⚠️ Password errata. Riprova.</div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Invio proposta firmata in corso...</div>
    </div>

    <div class="container" id="proposalContainer" style="display: none;">
        <div class="timer-display" id="timerDisplay">
            ⏰ Tempo rimanente per firmare: <span id="timerText"></span>
        </div>

        <div class="status-banner" id="statusBanner">
            ✅ PROPOSTA FIRMATA E ACCETTATA DIGITALMENTE
        </div>

        <div class="header">
            <div class="company-info">
                <h1>Domenico Riccio</h1>
                <div class="tagline">Web & App Solutions</div>
                <p><strong>Sviluppatore Full-Stack Senior</strong></p>
                <p>Via Ol Mött 6, 6703 Osogna, Svizzera</p>
                <p>📞 Tel: 076 781 01 94</p>
                <p>✉️ Email: info@dcreativo.ch</p>
                <p>🌐 Web: dcreativo.ch</p>
            </div>
            <div class="client-info">
                <h2>Centro Sinapsi</h2>
                <p><strong>Shote - Proprietaria</strong></p>
                <p>Via Toron d'Örz 7, 6703 Osogna</p>
                <p>📞 Tel: 078 846 06 87</p>
                <p>✉️ Email: info@centrosinapsi.ch</p>
                <p style="margin-top: 15px; color: #666;"><strong>Data:</strong> <span id="currentDate"></span></p>
            </div>
        </div>

        <div class="app-title">
            <h1>🏠 Centro Sinapsi PWA</h1>
            <p>Progressive Web Application Completa</p>
        </div>

        <div class="section">
            <h2>🛠️ Servizi di Sviluppo Inclusi</h2>
            <div class="services-grid">

                <div class="service-category">
                    <h3>
                        🎯 Portale Clienti Completo
                        <span class="service-price">CHF 2'500</span>
                    </h3>
                    <ul class="service-list">
                        <li>Sistema registrazione e login sicuro con verifica email</li>
                        <li>Dashboard personalizzata per ogni famiglia</li>
                        <li>Gestione profili bambini (età, allergie, note mediche)</li>
                        <li>Sistema prenotazioni sala eventi con calendario interattivo</li>
                        <li>Iscrizione mensa scolastica (6-14 anni) con gestione posti</li>
                        <li>Richiesta doposcuola con aiuto compiti</li>
                        <li>Form digitali intelligenti per preventivi pulizie personalizzati</li>
                        <li>Pagamenti Stripe Link per mensa, doposcuola e noleggio sala</li>
                        <li>Storico completo di tutte le prenotazioni e servizi</li>
                        <li>Sistema notifiche in-app con campanella</li>
                        <li>Interfaccia responsive per tutti i dispositivi</li>
                        <li>Generazione automatica preventivi pulizie in tempo reale</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        🔧 Dashboard Amministratore Avanzata
                        <span class="service-price">CHF 2'000</span>
                    </h3>
                    <ul class="service-list">
                        <li>Pannello controllo completo con statistiche real-time</li>
                        <li>Gestione prenotazioni (conferma, modifica, annullamento)</li>
                        <li>Controllo disponibilità sala con calendario admin</li>
                        <li>Gestione servizi, prezzi e fasce orarie</li>
                        <li>Analytics avanzate con grafici e metriche</li>
                        <li>Report automatici giornalieri, settimanali, mensili</li>
                        <li>Gestione database utenti e famiglie</li>
                        <li>Sistema di backup e sicurezza dati</li>
                        <li>Esportazione dati in CSV/PDF</li>
                        <li>Pannello notifiche amministratore</li>
                        <li>Generazione preventivi automatizzata per servizi pulizie</li>
                        <li>Generazione fatture automatizzata con intestazione Centro Sinapsi</li>
                        <li>Sistema fatturazione con IBAN, riferimenti e codici QR</li>
                        <li>Pagamenti Stripe Link integrati per tutti i servizi</li>
                        <li>Gestione form digitali per preventivi pulizie personalizzati</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        📱 Integrazione WhatsApp Twilio
                        <span class="service-price">CHF 800</span>
                    </h3>
                    <ul class="service-list">
                        <li>Setup account Twilio professionale</li>
                        <li>Integrazione API WhatsApp Business</li>
                        <li>Notifiche automatiche conferma prenotazioni</li>
                        <li>Promemoria automatici 24h e 2h prima</li>
                        <li>Messaggi personalizzati per ogni servizio</li>
                        <li>Template professionali per comunicazioni</li>
                        <li>Sistema di invio bulk per comunicazioni importanti</li>
                        <li>Tracking consegna e lettura messaggi</li>
                        <li>Gestione opt-in/opt-out clienti</li>
                        <li>Dashboard monitoraggio invii</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        🤖 Sistema Automazioni e Cron Jobs
                        <span class="service-price">CHF 600</span>
                    </h3>
                    <ul class="service-list">
                        <li>Promemoria automatici personalizzati</li>
                        <li>Pulizia automatica database vecchie prenotazioni</li>
                        <li>Backup automatici giornalieri</li>
                        <li>Report statistici settimanali automatici</li>
                        <li>Sincronizzazione dati in tempo reale</li>
                        <li>Monitoraggio sistema e alert errori</li>
                        <li>Aggiornamento automatico disponibilità</li>
                        <li>Scadenza automatica prenotazioni non confermate</li>
                        <li>Archiviazione automatica dati storici</li>
                        <li>Sistema di logging completo</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        📧 Sistema Email Professionale
                        <span class="service-price">CHF 400</span>
                    </h3>
                    <ul class="service-list">
                        <li>Setup email transazionali con Nodemailer</li>
                        <li>Template email professionali responsive</li>
                        <li>Email conferma registrazione e verifica</li>
                        <li>Conferme prenotazioni personalizzate</li>
                        <li>Email promemoria automatici</li>
                        <li>Newsletter e comunicazioni di massa</li>
                        <li>Email recupero password sicure</li>
                        <li>Tracking apertura e click email</li>
                        <li>Sistema anti-spam e deliverability</li>
                        <li>Log completo invii email</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        🎨 Servizio Fotografico e Video
                        <span class="service-price">CHF 700</span>
                    </h3>
                    <ul class="service-list">
                        <li>Servizio fotografico professionale del centro</li>
                        <li>Foto degli spazi (sala eventi, mensa, aree gioco)</li>
                        <li>Foto dei servizi e attività</li>
                        <li>Video promozionale del centro (2-3 minuti)</li>
                        <li>Post-produzione e editing professionale</li>
                        <li>Ottimizzazione immagini per web</li>
                        <li>Creazione gallery fotografica nell'app</li>
                        <li>Video testimonials clienti</li>
                        <li>Materiale per social media</li>
                        <li>Foto professionali per brochure e marketing</li>
                    </ul>
                </div>

                <div class="service-category">
                    <h3>
                        🚀 Setup Tecnico e SEO Avanzato
                        <span class="service-price">CHF 1'000</span>
                    </h3>
                    <ul class="service-list">
                        <li>Configurazione hosting premium Infomaniak</li>
                        <li>Setup dominio centrosinapsi.ch</li>
                        <li>Certificati SSL e sicurezza avanzata</li>
                        <li>Ottimizzazione SEO on-page completa per tutti i servizi</li>
                        <li>Ricerca parole chiave per pulizie, doposcuola, mensa</li>
                        <li>Setup Google Business Profile ottimizzato</li>
                        <li>Integrazione Google Analytics e Search Console</li>
                        <li>Ottimizzazione velocità e performance Core Web Vitals</li>
                        <li>Schema markup per servizi locali</li>
                        <li>Sitemap XML e robots.txt ottimizzati</li>
                        <li>Configurazione backup automatici</li>
                        <li>Monitoraggio uptime e disponibilità</li>
                        <li>Formazione completa utilizzo piattaforma</li>
                        <li>Strategia SEO locale per area Ticino</li>
                    </ul>
                </div>

            </div>
        </div>

        <div class="section">
            <h2>💻 Stack Tecnologico Premium</h2>
            <div class="tech-stack">
                <h3>Tecnologie utilizzate per garantire performance, sicurezza e scalabilità</h3>
                <div class="tech-grid">
                    <div class="tech-item">
                        <h4>Next.js 14</h4>
                        <p>Framework React avanzato</p>
                    </div>
                    <div class="tech-item">
                        <h4>TypeScript</h4>
                        <p>Codice sicuro e scalabile</p>
                    </div>
                    <div class="tech-item">
                        <h4>Prisma ORM</h4>
                        <p>Database relazionale</p>
                    </div>
                    <div class="tech-item">
                        <h4>NextAuth.js</h4>
                        <p>Autenticazione sicura</p>
                    </div>
                    <div class="tech-item">
                        <h4>Tailwind CSS</h4>
                        <p>Design moderno</p>
                    </div>
                    <div class="tech-item">
                        <h4>Framer Motion</h4>
                        <p>Animazioni fluide</p>
                    </div>
                    <div class="tech-item">
                        <h4>Stripe API</h4>
                        <p>Pagamenti sicuri</p>
                    </div>
                    <div class="tech-item">
                        <h4>Twilio API</h4>
                        <p>WhatsApp Business</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>💰 Investimento per il Progetto</h2>
            <div class="pricing-summary">
                <h3>Riepilogo Costi Servizi</h3>

                <table class="price-table">
                    <thead>
                        <tr>
                            <th>Servizio</th>
                            <th>Prezzo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="service-name">🎯 Portale Clienti Completo</td>
                            <td class="price">CHF 2'500</td>
                        </tr>
                        <tr>
                            <td class="service-name">🔧 Dashboard Amministratore Avanzata</td>
                            <td class="price">CHF 2'000</td>
                        </tr>
                        <tr>
                            <td class="service-name">📱 Integrazione WhatsApp Twilio</td>
                            <td class="price">CHF 800</td>
                        </tr>
                        <tr>
                            <td class="service-name">🤖 Sistema Automazioni e Cron Jobs</td>
                            <td class="price">CHF 600</td>
                        </tr>
                        <tr>
                            <td class="service-name">📧 Sistema Email Professionale</td>
                            <td class="price">CHF 400</td>
                        </tr>
                        <tr>
                            <td class="service-name">🎨 Servizio Fotografico e Video</td>
                            <td class="price">CHF 700</td>
                        </tr>
                        <tr>
                            <td class="service-name">🚀 Setup Tecnico e SEO Avanzato</td>
                            <td class="price">CHF 1'000</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTALE SERVIZI</strong></td>
                            <td><strong>CHF 8'000</strong></td>
                        </tr>
                        <tr class="discount-row">
                            <td><strong>SCONTO SPECIALE (-40%)</strong></td>
                            <td><strong>- CHF 3'200</strong></td>
                        </tr>
                        <tr class="final-row">
                            <td><strong>PREZZO FINALE</strong></td>
                            <td><strong>CHF 4'800</strong></td>
                        </tr>
                    </tbody>
                </table>

                <div class="discount-highlight">
                    <h3>🎉 Offerta Speciale Centro Sinapsi</h3>
                    <p><strong>Risparmio di CHF 3'200 sul prezzo totale dei servizi!</strong></p>
                    <p>Sconto del 40% applicato come investimento per la crescita digitale del centro</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>📅 Cronoprogramma di Sviluppo</h2>
            <div class="timeline-section">
                <h3>Tempistiche di realizzazione: 10-12 settimane</h3>

                <div class="timeline-item">
                    <div class="week">Sett. 1-2</div>
                    <div class="timeline-content">
                        <strong>Setup e Progettazione</strong><br>
                        Configurazione ambiente, database design, wireframe e mockup
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 3</div>
                    <div class="timeline-content">
                        <strong>Servizio Fotografico</strong><br>
                        Shooting professionale del centro, video promozionale, post-produzione
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 4-6</div>
                    <div class="timeline-content">
                        <strong>Sviluppo Portale Clienti</strong><br>
                        Frontend responsive, sistema autenticazione, prenotazioni
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 7-8</div>
                    <div class="timeline-content">
                        <strong>Dashboard Amministratore</strong><br>
                        Pannello admin, analytics, gestione prenotazioni, report
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 9</div>
                    <div class="timeline-content">
                        <strong>Integrazioni e Automazioni</strong><br>
                        WhatsApp Twilio, email system, cron jobs, notifiche
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 10-11</div>
                    <div class="timeline-content">
                        <strong>Testing e Ottimizzazioni</strong><br>
                        Test funzionali, ottimizzazione performance, correzione bug
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="week">Sett. 12</div>
                    <div class="timeline-content">
                        <strong>Deploy e Formazione</strong><br>
                        Messa online, formazione team, documentazione
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>💳 Opzioni di Pagamento</h2>
            <div class="payment-options">
                <h3>Modalità flessibili per ogni esigenza di budget</h3>

                <div class="payment-grid">
                    <div class="payment-card" data-option="rapid">
                        <h4>📅 Opzione A - Pagamento Rapido</h4>
                        <div class="payment-badge">NESSUN COSTO AGGIUNTIVO</div>
                        <table class="payment-table">
                            <tr>
                                <td><strong>Acconto alla firma (30%)</strong></td>
                                <td><strong>CHF 1'440</strong></td>
                            </tr>
                            <tr>
                                <td>A metà progetto</td>
                                <td>CHF 1'680</td>
                            </tr>
                            <tr>
                                <td>Alla consegna finale</td>
                                <td>CHF 1'680</td>
                            </tr>
                            <tr class="total-payment-row">
                                <td><strong>TOTALE</strong></td>
                                <td><strong>CHF 4'800</strong></td>
                            </tr>
                        </table>
                        <p style="font-size: 12px; margin-top: 10px; color: #666;">✅ Pagamento rapido senza costi amministrativi</p>
                        <input type="radio" name="payment-choice" value="rapid" id="payment-rapid" style="margin-top: 15px; transform: scale(1.2);">
                        <label for="payment-rapid" style="margin-left: 8px; font-weight: bold; cursor: pointer;">Scelgo questa opzione</label>
                    </div>

                    <div class="payment-card" data-option="extended">
                        <h4>📅 Opzione B - Rateizzazione Estesa</h4>
                        <div class="payment-badge extended">+CHF 60 COSTI AMMINISTRATIVI</div>
                        <table class="payment-table">
                            <tr>
                                <td><strong>Acconto alla firma (30%)</strong></td>
                                <td><strong>CHF 1'440</strong></td>
                            </tr>
                            <tr>
                                <td>36 rate mensili</td>
                                <td>CHF 95/mese</td>
                            </tr>
                            <tr>
                                <td><strong>Totale rateizzato</strong></td>
                                <td><strong>CHF 3'420</strong></td>
                            </tr>
                            <tr class="total-payment-row">
                                <td><strong>TOTALE FINALE</strong></td>
                                <td><strong>CHF 4'860</strong></td>
                            </tr>
                        </table>
                        <p style="font-size: 12px; margin-top: 10px; color: #666;">⚠️ Include CHF 60 costi amministrativi rateizzazione</p>
                        <input type="radio" name="payment-choice" value="extended" id="payment-extended" style="margin-top: 15px; transform: scale(1.2);">
                        <label for="payment-extended" style="margin-left: 8px; font-weight: bold; cursor: pointer;">Scelgo questa opzione</label>
                    </div>
                </div>

                <!-- Opzione C - Personalizzata -->
                <div class="payment-card-full" data-option="custom">
                    <h4>🎯 Opzione C - Rateizzazione Personalizzata</h4>
                    <div class="payment-badge extended">+CHF 60 COSTI AMMINISTRATIVI</div>

                    <div class="custom-payment-section">
                        <div class="custom-payment-intro">
                            <p><strong>Crea la tua rateizzazione personalizzata!</strong></p>
                            <p>L'acconto del 30% (CHF 1'440) alla firma è obbligatorio. Puoi decidere come rateizzare il restante 70%.</p>
                        </div>

                        <div class="custom-payment-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="custom-installments">📊 Numero di Rate Mensili</label>
                                    <input type="number" id="custom-installments" min="2" max="60" placeholder="Es. 12"
                                           oninput="calculateCustomPayment()" class="form-input">
                                    <small>Minimo 2 rate, massimo 60 rate</small>
                                </div>

                                <div class="form-group">
                                    <label for="custom-amount">💰 Importo per Rata (CHF)</label>
                                    <input type="number" id="custom-amount" min="50" step="5" placeholder="Es. 150"
                                           oninput="calculateCustomPayment()" class="form-input">
                                    <small>Minimo CHF 50 per rata</small>
                                </div>
                            </div>

                            <div class="calculation-result" id="customCalculation" style="display: none;">
                                <div class="calculation-table">
                                    <table class="payment-table">
                                        <tr>
                                            <td><strong>Acconto alla firma (30%)</strong></td>
                                            <td><strong>CHF 1'440</strong></td>
                                        </tr>
                                        <tr>
                                            <td id="installment-description">Rate mensili</td>
                                            <td id="installment-total">CHF 0</td>
                                        </tr>
                                        <tr>
                                            <td>Costi amministrativi</td>
                                            <td>CHF 60</td>
                                        </tr>
                                        <tr class="total-payment-row">
                                            <td><strong>TOTALE FINALE</strong></td>
                                            <td><strong id="custom-total">CHF 0</strong></td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="validation-message" id="validationMessage"></div>
                            </div>
                        </div>

                        <div class="custom-payment-footer">
                            <input type="radio" name="payment-choice" value="custom" id="payment-custom" style="transform: scale(1.2);">
                            <label for="payment-custom" style="margin-left: 8px; font-weight: bold; cursor: pointer;">
                                Scelgo la mia rateizzazione personalizzata
                            </label>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <p><strong>⚠️ Importante:</strong> I costi annuali di gestione (CHF 625/anno) sono separati e fatturati a parte dal secondo anno di attività dell'applicazione.</p>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>💼 Costi Annuali di Gestione (Separati)</h3>
            <p>Dopo il lancio dell'applicazione, per mantenere tutti i servizi sempre attivi:</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; font-size: clamp(12px, 2.5vw, 14px);">
                <div>• <strong>Hosting Premium:</strong> CHF 180/anno</div>
                <div>• <strong>Dominio:</strong> CHF 25/anno</div>
                <div>• <strong>Twilio WhatsApp:</strong> CHF 120/anno</div>
                <div>• <strong>Assistenza tecnica:</strong> CHF 300/anno</div>
            </div>
            <p><strong>Totale gestione annuale: CHF 625 (CHF 52/mese)</strong></p>
            <p style="font-style: italic; margin-top: 10px; color: #666;">*Questi costi sono fatturati separatamente dal secondo anno di attività dell'applicazione</p>
        </div>

        <!-- Sezione Firma Digitale -->
        <div class="signature-section" id="signatureSection">
            <h2>✍️ Accettazione e Firma Digitale</h2>

            <div class="signature-content">
                <div class="acceptance-checkboxes">
                    <h4 style="color: #2c5aa0; margin-bottom: 20px; font-size: clamp(14px, 3vw, 18px);">Conferma di Accettazione</h4>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-terms" required>
                        <label for="accept-terms">
                            <strong>Accetto tutti i servizi e le condizioni</strong> descritti in questa proposta per lo sviluppo della PWA Centro Sinapsi al prezzo finale di <strong>CHF 4'800</strong>
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-timeline" required>
                        <label for="accept-timeline">
                            <strong>Confermo i tempi di realizzazione</strong> di 10-12 settimane e il cronoprogramma di sviluppo presentato
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-payment" required>
                        <label for="accept-payment">
                            <strong>Ho scelto la mia opzione di pagamento</strong> tra le tre disponibili nella sezione precedente
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="accept-annual-costs" required>
                        <label for="accept-annual-costs">
                            <strong>Sono consapevole dei costi annuali di gestione</strong> di CHF 625/anno dal secondo anno di attività dell'applicazione
                        </label>
                    </div>
                </div>

                <div class="signature-canvas-container">
                    <h4 style="color: #2c5aa0; margin-bottom: 15px; font-size: clamp(14px, 3vw, 18px);">Firma Digitale</h4>
                    <p style="margin-bottom: 15px; color: #666; font-size: clamp(12px, 2.5vw, 14px);">
                        Disegna la tua firma nel riquadro sottostante usando il mouse o il dito su dispositivi touch
                    </p>

                    <canvas id="signatureCanvas" class="signature-canvas" width="500" height="200"></canvas>

                    <div class="signature-controls">
                        <button type="button" class="btn btn-clear" onclick="clearSignature()">
                            🗑️ Cancella Firma
                        </button>
                        <button type="button" class="btn btn-submit" id="submitBtn" onclick="submitProposal()" disabled>
                            ✅ Firma e Accetta Proposta
                        </button>
                    </div>

                    <div class="signature-info">
                        <p><strong>📋 Informazioni:</strong> Firmando digitalmente questa proposta, accetti tutti i termini e condizioni. La firma ha lo stesso valore legale di una firma cartacea.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messaggio di Successo -->
        <div class="success-message" id="successMessage">
            <h2>🎉 Proposta Firmata con Successo!</h2>
            <p>Grazie per aver accettato la proposta. Il contratto è ora vincolante e inizieremo subito i lavori di sviluppo.</p>
            <p><strong>Ti abbiamo inviato una copia della proposta firmata via email. Ti contatteremo entro 24 ore per organizzare il primo incontro e l'acconto.</strong></p>
        </div>

        <!-- Anteprima Firma (visibile solo dopo la firma) -->
        <div class="signature-preview" id="signaturePreview" style="display: none;">
            <h4>📋 Dettagli Firma Digitale</h4>
            <div class="signature-details">
                <div><strong>Data e Ora:</strong> <span id="signatureDate"></span></div>
                <div><strong>Cliente:</strong> Centro Sinapsi - Shote</div>
                <div><strong>Sviluppatore:</strong> Domenico Riccio</div>
                <div><strong>Importo:</strong> CHF 4'800</div>
                <div><strong>Opzione Pagamento:</strong> <span id="selectedPayment"></span></div>
                <div><strong>IP Address:</strong> <span id="clientIP"></span></div>
            </div>
            <div style="margin-top: 15px;">
                <strong>Firma:</strong><br>
                <img id="signatureImage" style="border: 1px solid #ddd; border-radius: 5px; max-width: 100%; height: auto;">
            </div>
        </div>

        <div class="cta-section">
            <h2>🚀 Trasformiamo Insieme il Centro Sinapsi!</h2>
            <p>Una soluzione digitale completa che automatizzerà tutti i processi di prenotazione e gestione clienti, portando il vostro centro nell'era digitale con tecnologie all'avanguardia.</p>
            <div style="margin-top: 30px; font-size: clamp(16px, 4vw, 22px);">
                <strong>💻 Tecnologie Premium • 📱 App Moderna • 🤖 Automazioni Smart</strong>
            </div>
        </div>

        <div class="contact-section">
            <h3>📞 Conferma e Inizio Sviluppo</h3>
            <p style="font-size: clamp(16px, 3.5vw, 20px); margin-bottom: 15px;"><strong>Domenico Riccio</strong></p>
            <p>📱 WhatsApp: 076 781 01 94</p>
            <p>✉️ Email: info@dcreativo.ch</p>
            <p style="margin-top: 25px; color: #666; font-size: clamp(12px, 2.5vw, 14px);">Questa proposta è valida per 30 giorni dalla prima apertura.</p>
        </div>
    </div>

    <script>
        // Configurazione
        const CONFIG = {
    password: 'centrosinapsi2025',
    expiryDays: 30,
    apiEndpoint: '/api/send-proposal' // Endpoint Vercel Function
};

        // Variabili globali
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let hasSignature = false;
        let timerInterval = null;
        let isExpired = false;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            setupPasswordScreen();
            updateCurrentDate();

            // Controllo se l'utente ha già effettuato l'accesso
            if (localStorage.getItem('centrosinapsi_access')) {
                showProposal();
            }
        });

        // Setup schermata password
        function setupPasswordScreen() {
            const passwordInput = document.getElementById('passwordInput');
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        }

        // Controllo password
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorMessage = document.getElementById('errorMessage');

            if (password === CONFIG.password) {
                // Salva l'accesso e la data della prima apertura
                const accessData = {
                    firstAccess: Date.now(),
                    hasAccess: true
                };
                localStorage.setItem('centrosinapsi_access', JSON.stringify(accessData));

                // Mostra la proposta
                showProposal();
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        // Mostra la proposta
        function showProposal() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('proposalContainer').style.display = 'block';

            // Inizializza tutto
            initializeSignature();
            checkStoredSignature();
            setupEventListeners();
            startTimer();
            animateElements();
        }

        // Aggiorna la data corrente
        function updateCurrentDate() {
            const now = new Date();
            const options = {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                timeZone: 'Europe/Zurich'
            };

            const formatter = new Intl.DateTimeFormat('it-IT', options);
            const currentDateFormatted = formatter.format(now);

            document.getElementById('currentDate').textContent = currentDateFormatted;
        }

        // Avvia il timer di 30 giorni
        function startTimer() {
            const accessData = JSON.parse(localStorage.getItem('centrosinapsi_access'));
            if (!accessData || !accessData.firstAccess) return;

            const firstAccess = new Date(accessData.firstAccess);
            const expiryDate = new Date(firstAccess.getTime() + (CONFIG.expiryDays * 24 * 60 * 60 * 1000));

            timerInterval = setInterval(function() {
                const now = new Date();
                const timeLeft = expiryDate - now;

                if (timeLeft <= 0) {
                    // Scaduto
                    clearInterval(timerInterval);
                    showExpiredState();
                    return;
                }

                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('timerText').textContent = `${days}d ${hours}h ${minutes}m`;
            }, 60000); // Aggiorna ogni minuto

            // Aggiorna subito
            const now = new Date();
            const timeLeft = expiryDate - now;
            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('timerText').textContent = `${days}d ${hours}h ${minutes}m`;
            } else {
                showExpiredState();
            }
        }

        // Mostra stato scaduto
        function showExpiredState() {
            isExpired = true;
            const timerDisplay = document.getElementById('timerDisplay');
            timerDisplay.classList.add('expired');
            timerDisplay.innerHTML = '⏰ <strong>PROPOSTA SCADUTA</strong> - Contatta Domenico Riccio per una nuova proposta';

            // Disabilita la sezione firma
            const signatureSection = document.getElementById('signatureSection');
            if (signatureSection) {
                signatureSection.style.opacity = '0.5';
                signatureSection.style.pointerEvents = 'none';
            }
        }

        // Inizializza il canvas per la firma
        function initializeSignature() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');

            // Imposta le proprietà del canvas
            ctx.strokeStyle = '#2c5aa0';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Riempie il canvas con sfondo bianco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Event listeners per desktop
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Event listeners per mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        // Gestisce eventi touch per mobile
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            if (e.type === 'touchstart') {
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(x, y);
            } else if (e.type === 'touchmove' && isDrawing) {
                ctx.lineTo(x, y);
                ctx.stroke();
                hasSignature = true;
                checkFormValidity();
            }
        }

        // Inizia il disegno
        function startDrawing(e) {
            if (isExpired) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        // Disegna
        function draw(e) {
            if (!isDrawing || isExpired) return;

            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            hasSignature = true;
            checkFormValidity();
        }

        // Ferma il disegno
        function stopDrawing() {
            isDrawing = false;
        }

        // Cancella la firma
        function clearSignature() {
            if (isExpired) return;
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
            checkFormValidity();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Checkbox listeners
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', checkFormValidity);
            });

            // Payment option listeners
            document.querySelectorAll('input[name="payment-choice"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updatePaymentSelection(this.value);
                    checkFormValidity();
                });
            });

            // Custom payment inputs
            document.getElementById('custom-installments').addEventListener('input', calculateCustomPayment);
            document.getElementById('custom-amount').addEventListener('input', calculateCustomPayment);
        }

        // Aggiorna la selezione del pagamento
        function updatePaymentSelection(selectedOption) {
            // Rimuove classe selected da tutte le card
            document.querySelectorAll('.payment-card, .payment-card-full').forEach(card => {
                card.classList.remove('selected');
            });

            // Aggiunge classe selected alla card scelta
            const selectedCard = document.querySelector(`[data-option="${selectedOption}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // Mostra/nasconde sezione custom
            const customSection = document.getElementById('customCalculation');
            if (selectedOption === 'custom') {
                calculateCustomPayment();
            }
        }

        // Calcola rateizzazione personalizzata
        function calculateCustomPayment() {
            const installments = parseInt(document.getElementById('custom-installments').value) || 0;
            const amount = parseFloat(document.getElementById('custom-amount').value) || 0;
            const customSection = document.getElementById('customCalculation');
            const validationMessage = document.getElementById('validationMessage');

            if (installments === 0 || amount === 0) {
                customSection.style.display = 'none';
                return;
            }

            customSection.style.display = 'block';

            // Calcoli
            const downPayment = 1440; // 30% fisso
            const adminCosts = 60;
            const installmentTotal = installments * amount;
            const grandTotal = downPayment + installmentTotal + adminCosts;
            const minimumTotal = 4860; // CHF 4800 + CHF 60

            // Aggiorna tabella
            document.getElementById('installment-description').textContent = `${installments} rate da CHF ${amount}`;
            document.getElementById('installment-total').textContent = `CHF ${installmentTotal.toLocaleString('de-CH')}`;
            document.getElementById('custom-total').textContent = `CHF ${grandTotal.toLocaleString('de-CH')}`;

            // Validazione
            let isValid = false;
            let message = '';

            if (installments < 2) {
                message = '⚠️ Numero minimo di rate: 2';
                validationMessage.className = 'validation-message invalid';
            } else if (installments > 60) {
                message = '⚠️ Numero massimo di rate: 60';
                validationMessage.className = 'validation-message invalid';
            } else if (amount < 50) {
                message = '⚠️ Importo minimo per rata: CHF 50';
                validationMessage.className = 'validation-message invalid';
            } else if (grandTotal < minimumTotal) {
                const shortage = minimumTotal - grandTotal;
                message = `⚠️ Importo insufficiente. Mancano CHF ${shortage.toLocaleString('de-CH')} per raggiungere il minimo di CHF ${minimumTotal.toLocaleString('de-CH')}`;
                validationMessage.className = 'validation-message invalid';
            } else {
                message = `✅ Rateizzazione valida! Totale: CHF ${grandTotal.toLocaleString('de-CH')}`;
                validationMessage.className = 'validation-message valid';
                isValid = true;
            }

            validationMessage.textContent = message;

            // Abilita/disabilita radio button
            const customRadio = document.getElementById('payment-custom');
            if (isValid) {
                customRadio.disabled = false;
                customRadio.parentElement.style.opacity = '1';
            } else {
                customRadio.disabled = true;
                customRadio.checked = false;
                customRadio.parentElement.style.opacity = '0.6';
            }

            checkFormValidity();
        }

        // Controlla la validità del form
        function checkFormValidity() {
            if (isExpired) return;

            const checkboxes = document.querySelectorAll('input[type="checkbox"][required]');
            const paymentRadios = document.querySelectorAll('input[name="payment-choice"]');
            const submitBtn = document.getElementById('submitBtn');

            let allChecked = true;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });

            let hasPaymentOption = false;
            paymentRadios.forEach(radio => {
                if (radio.checked && !radio.disabled) {
                    hasPaymentOption = true;
                }
            });

            // Abilita il pulsante solo se tutto è compilato
            if (allChecked && hasPaymentOption && hasSignature) {
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // Invia la proposta
        async function submitProposal() {
            if (!hasSignature || isExpired) {
                alert('⚠️ Per favore, inserisci la tua firma prima di procedere.');
                return;
            }

            // Conferma finale
            const confirmSubmit = confirm('🤝 Sei sicuro di voler firmare e accettare questa proposta? Una volta confermata, sarà vincolante.');
            if (!confirmSubmit) return;

            // Mostra loading
            document.getElementById('loadingScreen').style.display = 'flex';

            try {
                // Raccoglie opzione di pagamento selezionata
                const selectedPayment = document.querySelector('input[name="payment-choice"]:checked');
                let paymentDetails = {};

                if (selectedPayment.value === 'rapid') {
                    paymentDetails = {
                        option: 'rapid',
                        description: 'Opzione A - Pagamento Rapido',
                        total: 'CHF 4\'800',
                        details: '3 rate: CHF 1\'440 + CHF 1\'680 + CHF 1\'680'
                    };
                } else if (selectedPayment.value === 'extended') {
                    paymentDetails = {
                        option: 'extended',
                        description: 'Opzione B - Rateizzazione Estesa',
                        total: 'CHF 4\'860',
                        details: 'CHF 1\'440 + 36 rate da CHF 95/mese'
                    };
                } else if (selectedPayment.value === 'custom') {
                    const installments = document.getElementById('custom-installments').value;
                    const amount = document.getElementById('custom-amount').value;
                    const total = 1440 + (installments * amount) + 60;

                    paymentDetails = {
                        option: 'custom',
                        description: 'Opzione C - Rateizzazione Personalizzata',
                        total: `CHF ${total.toLocaleString('de-CH')}`,
                        details: `CHF 1'440 + ${installments} rate da CHF ${amount}/mese + CHF 60 costi amministrativi`,
                        installments: installments,
                        monthlyAmount: amount
                    };
                }

                // Raccoglie i dati
                const signatureData = {
                    date: new Date().toLocaleString('it-IT'),
                    paymentOption: paymentDetails,
                    signatureImage: canvas.toDataURL(),
                    clientIP: await getClientIP(),
                    timestamp: Date.now()
                };

                // Genera PDF
                const pdfBlob = await generatePDF(signatureData);

                // Invia email
                await sendSignedProposal(signatureData, pdfBlob);

                // Salva in localStorage
                localStorage.setItem('centrosinapsi_signature', JSON.stringify(signatureData));

                // Mostra il successo
                showSuccess(signatureData);

            } catch (error) {
                console.error('Errore nell\'invio:', error);
                alert('⚠️ Si è verificato un errore durante l\'invio. Riprova o contatta Domenico Riccio.');
            } finally {
                // Nascondi loading
                document.getElementById('loadingScreen').style.display = 'none';
            }
        }

        // Genera PDF
        async function generatePDF(signatureData) {
            return new Promise((resolve, reject) => {
                try {
                    // Crea una copia pulita del contenuto
                    const originalContainer = document.getElementById('proposalContainer');
                    const cleanContainer = originalContainer.cloneNode(true);

                    // Rimuove elementi non necessari per il PDF
                    const elementsToRemove = [
                        '.signature-section',
                        '.success-message',
                        '.timer-display',
                        '.loading-screen',
                        '.status-banner',
                        'script',
                        '.login-screen'
                    ];

                    elementsToRemove.forEach(selector => {
                        const elements = cleanContainer.querySelectorAll(selector);
                        elements.forEach(el => el.remove());
                    });

                    // Aggiunge la sezione firma al PDF
                    const signatureSection = document.createElement('div');
                    signatureSection.style.cssText = `
                        background: #f8f9fa;
                        padding: 25px;
                        border-radius: 15px;
                        margin: 30px 0;
                        border: 2px solid #4CAF50;
                        page-break-inside: avoid;
                    `;

                    signatureSection.innerHTML = `
                        <h3 style="color: #2c5aa0; margin-bottom: 20px; font-size: 18px;">✅ Proposta Firmata Digitalmente</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; font-size: 14px;">
                            <div><strong>Data e Ora:</strong> ${signatureData.date}</div>
                            <div><strong>Cliente:</strong> Centro Sinapsi - Shote</div>
                            <div><strong>Opzione Pagamento:</strong> ${signatureData.paymentOption.description || 'Opzione selezionata'}</div>
                            <div><strong>IP Address:</strong> ${signatureData.clientIP}</div>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <strong>Firma Digitale:</strong><br>
                            <img src="${signatureData.signatureImage}" style="border: 1px solid #ddd; border-radius: 5px; max-width: 300px; height: auto; margin-top: 10px;">
                        </div>
                    `;

                    cleanContainer.appendChild(signatureSection);

                    // Applica stili per la stampa
                    cleanContainer.style.cssText = `
                        background: white;
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        font-size: 12px;
                        line-height: 1.4;
                        color: #333;
                        max-width: 210mm;
                        margin: 0 auto;
                        padding: 15mm;
                    `;

                    // Crea un container temporaneo nascosto
                    const tempContainer = document.createElement('div');
                    tempContainer.style.cssText = `
                        position: absolute;
                        top: -10000px;
                        left: -10000px;
                        width: 210mm;
                        background: white;
                        z-index: -1;
                    `;
                    tempContainer.appendChild(cleanContainer);
                    document.body.appendChild(tempContainer);

                    // Aspetta che il DOM sia pronto
                    setTimeout(() => {
                        html2canvas(cleanContainer, {
                            scale: 1.2,
                            useCORS: true,
                            allowTaint: false,
                            backgroundColor: '#ffffff',
                            width: 800,
                            height: cleanContainer.scrollHeight,
                            scrollX: 0,
                            scrollY: 0,
                            windowWidth: 800,
                            windowHeight: cleanContainer.scrollHeight
                        }).then(canvas => {
                            try {
                                // Rimuove il container temporaneo
                                document.body.removeChild(tempContainer);

                                // Genera PDF
                                const { jsPDF } = window.jspdf;
                                const pdf = new jsPDF('p', 'mm', 'a4');

                                const imgData = canvas.toDataURL('image/png', 0.8);
                                const imgWidth = 210; // A4 width
                                const pageHeight = 297; // A4 height
                                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                                let heightLeft = imgHeight;
                                let position = 0;

                                // Prima pagina
                                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
                                heightLeft -= pageHeight;

                                // Pagine successive se necessario
                                while (heightLeft >= 0) {
                                    position = heightLeft - imgHeight;
                                    pdf.addPage();
                                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
                                    heightLeft -= pageHeight;
                                }

                                const pdfBlob = pdf.output('blob');
                                resolve(pdfBlob);

                            } catch (pdfError) {
                                console.error('Errore generazione PDF:', pdfError);
                                document.body.removeChild(tempContainer);
                                reject(pdfError);
                            }
                        }).catch(canvasError => {
                            console.error('Errore html2canvas:', canvasError);
                            document.body.removeChild(tempContainer);
                            reject(canvasError);
                        });
                    }, 1000);

                } catch (error) {
                    console.error('Errore generale PDF:', error);
                    reject(error);
                }
            });
        }

        // Invia email con proposta firmata
        async function sendSignedProposal(signatureData, pdfBlob) {
            try {
                // Debug info
                console.log('📧 Preparazione invio email...');
                console.log('Dati firma:', signatureData);
                console.log('PDF size:', pdfBlob.size, 'bytes');

                // Converte il PDF in base64
                const pdfBase64 = await blobToBase64(pdfBlob);
                console.log('📎 PDF convertito in base64, lunghezza:', pdfBase64.length);

                // Prepara i dati per l'API
                const payload = {
                    signatureData: signatureData,
                    pdfBase64: pdfBase64
                };

                console.log('📤 Invio richiesta all\'API...');

                // Chiama la Vercel Function
                const response = await fetch(CONFIG.apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Errore HTTP: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log('✅ Email inviate con successo!');
                    console.log('🎉 Processo completato!');
                } else {
                    throw new Error(result.error || 'Errore sconosciuto');
                }

            } catch (error) {
                console.error('❌ Errore nell\'invio email:', error);
                throw error;
            }
        }

        // Converte blob in base64
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // Ottiene l'IP del cliente
        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'Non disponibile';
            }
        }

        // Mostra il messaggio di successo
        function showSuccess(signatureData) {
            // Nasconde la sezione firma
            document.getElementById('signatureSection').style.display = 'none';

            // Mostra il banner di stato
            const statusBanner = document.getElementById('statusBanner');
            statusBanner.classList.add('signed');

            // Mostra il messaggio di successo
            const successMessage = document.getElementById('successMessage');
            successMessage.classList.add('show');

            // Popola l'anteprima firma
            populateSignaturePreview(signatureData);

            // Scroll al messaggio di successo
            successMessage.scrollIntoView({ behavior: 'smooth' });
        }

        // Popola l'anteprima della firma
        function populateSignaturePreview(data) {
            document.getElementById('signatureDate').textContent = data.date;

            // Gestisce i dettagli del pagamento
            let paymentText = '';
            if (typeof data.paymentOption === 'string') {
                // Compatibilità con vecchi dati
                paymentText = data.paymentOption === 'rapid' ? 'Opzione A - Pagamento Rapido' : 'Opzione B - Rateizzazione Estesa';
            } else {
                paymentText = data.paymentOption.description + ' (' + data.paymentOption.total + ')';
            }

            document.getElementById('selectedPayment').textContent = paymentText;
            document.getElementById('clientIP').textContent = data.clientIP;
            document.getElementById('signatureImage').src = data.signatureImage;

            const preview = document.getElementById('signaturePreview');
            preview.style.display = 'block';
        }

        // Controlla se c'è già una firma salvata
        function checkStoredSignature() {
            const storedSignature = localStorage.getItem('centrosinapsi_signature');
            if (storedSignature) {
                const data = JSON.parse(storedSignature);
                showSuccess(data);
            }
        }

        // Animazioni al caricamento
        function animateElements() {
            // Intersection Observer per animazioni scroll
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });

            // Osserva le sezioni per l'animazione
            document.querySelectorAll('.section, .service-category, .tech-item').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                el.style.transition = 'all 0.6s ease-out';
                observer.observe(el);
            });
        }

        // Funzione di reset per debug (da rimuovere in produzione)
        function resetProposal() {
            localStorage.removeItem('centrosinapsi_signature');
            localStorage.removeItem('centrosinapsi_access');
            location.reload();
        }

        // Debug: aggiungi funzione globale per reset (rimuovi in produzione)
        window.resetProposal = resetProposal;
    </script>
</body>
</html>
